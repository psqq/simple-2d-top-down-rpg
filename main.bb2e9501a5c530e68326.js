!function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=13)}([function(t,e,n){"use strict";e.__esModule=!0;var i=n(15);e.Victor=i;var o=n(16);e.Matter=o;var r=n(18);e.EventEmitter=r;var s=n(19);e.path=s},function(t,e,n){"use strict";var i;e.__esModule=!0,function(t){t[t.UP=0]="UP",t[t.DOWN=1]="DOWN",t[t.LEFT=2]="LEFT",t[t.RIGHT=3]="RIGHT",t[t.NONE=4]="NONE"}(i||(i={})),e.default=i},function(t,e,n){"use strict";e.__esModule=!0;var i=n(6),o=n(0),r=function(){function t(t,e,n){this.gameImage=t,this.size=e,n.x*=this.size.x,n.y*=this.size.y,this.positionInImage=n}return t.fromArray=function(e,n){return new t(e,new o.Victor(n[0],n[1]),new o.Victor(n[2],n[3]))},t.fromImageAndArray=function(e,n){var o=i.GameImage.fromImage(e);return t.fromArray(o,n)},t}();e.default=r},function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(o,r){function s(t){try{l(i.next(t))}catch(t){r(t)}}function a(t){try{l(i.throw(t))}catch(t){r(t)}}function l(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(s,a)}l((i=i.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){var n,i,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}};e.__esModule=!0;var r=n(6),s=n(2);e.HERO=new r.GameImage("/assets/images/Hero.png","hero"),e.TINY_BASIC_THINGS=new r.GameImage("/assets/images/Tiny 16: Basic/things.png","things"),e.allImages=[e.HERO,e.TINY_BASIC_THINGS],e.HERO_IDLE_UP=s.default.fromArray(e.HERO,[16,16,0,0]),e.HERO_IDLE_DOWN=s.default.fromArray(e.HERO,[16,16,4,0]),e.HERO_IDLE_LEFT=s.default.fromArray(e.HERO,[16,16,0,1]),e.HERO_IDLE_RIGHT=s.default.fromArray(e.HERO,[16,16,4,1]),e.CLOSED_DOOR=s.default.fromArray(e.TINY_BASIC_THINGS,[16,16,0,0]),e.loadAllImages=function(){return i(this,void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return[4,Promise.all(e.allImages.map(function(t){return t.load()}))];case 1:return t.sent(),[2]}})})}},function(t,e,n){"use strict";e.__esModule=!0;var i=n(1),o=0;e.loadImage=function(t){return new Promise(function(e,n){var i=new Image;i.onload=function(){return e(i)},i.onerror=function(t){return n(t)},i.src=t})},e.loadJsonFile=function(t){return fetch(t).then(function(t){return t.json()})},e.directionVectorToDirection=function(t){return 0===t.length()?i.default.NONE:(t.norm(),Math.abs(t.y)>Math.abs(t.x)?t.y<0?i.default.UP:i.default.DOWN:t.x<0?i.default.LEFT:i.default.RIGHT)},e.getuid=function(){return o++}},function(t,e,n){"use strict";e.__esModule=!0;var i=n(0),o={density:1,friction:0,restitution:1,inertia:1/0,isStatic:!1},r=function(){function t(t){this.mainloop=t}return t.prototype.create=function(){return this.engine=i.Matter.Engine.create(),this.world=this.engine.world,this},t.prototype.noGravity=function(){this.world.gravity.y=0,this.world.gravity.x=0},t.prototype.update=function(){i.Matter.Engine.update(this.engine,this.mainloop.dt)},t.getArcadeBodySettings=function(){return Object.assign({},o)},t}();e.default=r},function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(o,r){function s(t){try{l(i.next(t))}catch(t){r(t)}}function a(t){try{l(i.throw(t))}catch(t){r(t)}}function l(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(s,a)}l((i=i.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){var n,i,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}};e.__esModule=!0;var r=n(4),s=n(0),a=n(2),l=function(){function t(t,e){void 0===e&&(e=null),this.size=new s.Victor(0,0),this.src=t,null==e&&(e=""+r.getuid()),this.name=e,this.tile=new a.default(this,this.size,new s.Victor(0,0))}return t.prototype.load=function(){return i(this,void 0,void 0,function(){var t;return o(this,function(e){switch(e.label){case 0:return t=this,[4,r.loadImage(this.src)];case 1:return t.img=e.sent(),this.size.x=this.img.width,this.size.y=this.img.height,[2,this]}})})},t.prototype.toTile=function(){return this.tile},t.fromImage=function(e){var n=new t(e.src);return n.size.x=e.width,n.size.y=e.height,n.img=e,n},t}();e.GameImage=l},function(t,e,n){"use strict";e.__esModule=!0;var i=n(21),o=n(1),r=n(23),s=n(24),a=n(25);e.init=function(t){e.moveLeftAction=new i.default(t,o.default.LEFT),e.moveRightAction=new i.default(t,o.default.RIGHT),e.moveUpAction=new i.default(t,o.default.UP),e.moveDownAction=new i.default(t,o.default.DOWN),e.cameraZoomOutAction=new r.default(t,-.1),e.cameraZoomInAction=new r.default(t,.1),e.moveToTargetAction=new s.default(t),e.clickAction=new a.default(t)}},function(t,e,n){"use strict";var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});e.__esModule=!0;var r=n(9),s=n(0),a=n(10),l=n(11),c=n(5),u=function(t){function e(e){var n=t.call(this)||this;return n.isAnimation=!1,n.bodySize=new s.Victor(16,16),n.opened=!1,n.game=e,n.sprite=new a.default(n.game.canvas),n}return o(e,t),e.prototype.createDoorBody=function(){var t=c.default.getArcadeBodySettings();t.isStatic=!0,this.createRectangleBody(this.bodySize,t)},e.prototype.init=function(){this.openDoorAnimation=r.OPEN_DOOR.getAnimation(this.game.mainloop).setDuration(300),this.sprite.setTile(this.openDoorAnimation.getTile(0)),t.prototype.init.call(this,this.game.physicsEngine.world),this.createDoorBody()},e.prototype.openDoor=function(){var t=this;this.isAnimation||(this.isAnimation=!0,this.openDoorAnimation.playFromBeginning().loop(!1).once("done",function(){t.removeBody(),t.opened=!0,t.isAnimation=!1}))},e.prototype.closeDoor=function(){var t=this;this.isAnimation||(this.isAnimation=!0,this.openDoorAnimation.playFromEnding().loop(!1).once("done",function(){t.body&&t.removeBody(),t.createDoorBody(),t.opened=!1,t.isAnimation=!1}))},e.prototype.update=function(){t.prototype.update.call(this),this.isAnimation&&(this.openDoorAnimation.update(),this.isAnimation?this.sprite.setTile(this.openDoorAnimation.getCurrentTile()):this.opened?this.sprite.setTile(this.openDoorAnimation.getTile(3)):this.sprite.setTile(this.openDoorAnimation.getTile(0)))},e.prototype.draw=function(){this.sprite.positioner.center(this.positionOfCenterInWorld).setLeftTopPosition(),this.sprite.draw()},e}(l.default);e.default=u},function(t,e,n){"use strict";e.__esModule=!0;var i=n(3),o=n(26);e.OPEN_DOOR=o.default.fromArrays(i.TINY_BASIC_THINGS,[16,16],[0,0,0,1,0,2,0,3]),e.HERO_WALK_UP=o.default.fromArrays(i.HERO,[16,16],[0,0,1,0,2,0,3,0]),e.HERO_WALK_DOWN=o.default.fromArrays(i.HERO,[16,16],[4,0,5,0,6,0,7,0]),e.HERO_WALK_LEFT=o.default.fromArrays(i.HERO,[16,16],[0,1,1,1,2,1,3,1]),e.HERO_WALK_RIGHT=o.default.fromArrays(i.HERO,[16,16],[4,1,5,1,6,1,7,1]),e.HERO_PUNCH_LEFT=o.default.fromArrays(i.HERO,[16,16],[0,2,1,2]),e.HERO_PUNCH_RIGHT=o.default.fromArrays(i.HERO,[16,16],[2,2,3,2]),e.HERO_PUNCH_UP=o.default.fromArrays(i.HERO,[16,16],[4,2,5,2]),e.HERO_PUNCH_DOWN=o.default.fromArrays(i.HERO,[16,16],[6,2,7,2])},function(t,e,n){"use strict";e.__esModule=!0;var i=n(0),o=n(28),r=function(){function t(t){this.leftTopPostion=new i.Victor(0,0),this.canvas=t,this.positioner=new o.default(this)}return t.prototype.setImage=function(t){this.tile=t.toTile()},t.prototype.setTile=function(t){this.tile=t},t.prototype.getSize=function(){if(null!=this.tile)return this.tile.size},t.prototype.setLeftTopPosition=function(t){this.leftTopPostion.x=t.x,this.leftTopPostion.y=t.y},t.prototype.draw=function(){this.canvas.context.drawImage(this.tile.gameImage.img,this.tile.positionInImage.x,this.tile.positionInImage.y,this.tile.size.x,this.tile.size.y,this.leftTopPostion.x,this.leftTopPostion.y,this.tile.size.x,this.tile.size.y)},t}();e.default=r},function(t,e,n){"use strict";var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});e.__esModule=!0;var r=n(0),s=function(t){function e(){return t.call(this)||this}return o(e,t),e.prototype.init=function(t){this.bodyContainer=t},e.prototype.setPosition=function(e){t.prototype.setPosition.call(this,e),r.Matter.Body.setPosition(this.body,r.Matter.Vector.create(e.x,e.y))},e.prototype.createCircleBody=function(t,e){void 0===e&&(e={}),this.size.x=t+t,this.size.y=t+t,this.body=r.Matter.Bodies.circle(this.positionOfCenterInWorld.x,this.positionOfCenterInWorld.y,t,e),r.Matter.Composite.add(this.bodyContainer,this.body)},e.prototype.createRectangleBody=function(t,e){void 0===e&&(e={}),this.size=t,this.body=r.Matter.Bodies.rectangle(this.positionOfCenterInWorld.x,this.positionOfCenterInWorld.y,t.x,t.y,e),r.Matter.Composite.add(this.bodyContainer,this.body)},e.prototype.kill=function(){t.prototype.kill.call(this),null!=this.body&&r.Matter.World.remove(this.bodyContainer,this.body)},e.prototype.removeBody=function(){r.Matter.Composite.remove(this.bodyContainer,this.body),this.body=null},e.prototype.syncWithBodyPosition=function(){this.positionOfCenterInWorld.x=this.body.position.x,this.positionOfCenterInWorld.y=this.body.position.y},e.prototype.update=function(){this.body&&this.syncWithBodyPosition()},e.prototype.draw=function(){},e}(n(29).default);e.default=s},function(t,e,n){"use strict";var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});e.__esModule=!0;var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return o(e,t),e.prototype.create=function(t){return this.canvasEl=document.createElement("canvas"),null!=t&&(this.canvasEl.width=t.x,this.canvasEl.height=t.y),this.context=this.canvasEl.getContext("2d"),this},e.prototype.appendTo=function(t){return document.querySelector(t).appendChild(this.canvasEl),this},e.prototype.setFullscreenSize=function(){this.canvasEl.width=window.innerWidth,this.canvasEl.height=window.innerHeight},e.prototype.setFullscreenStyles=function(){this.canvasEl.style.position="fixed",this.canvasEl.style.top="0px",this.canvasEl.style.left="0px"},e.prototype.alwaysFullscreen=function(){var t=this;this.setFullscreenStyles(),this.setFullscreenSize();return window.addEventListener("resize",function(){t.setFullscreenSize(),t.emit("resize")}),this},e.prototype.clear=function(){var t=this.canvasEl.width,e=this.canvasEl.height;return this.context.clearRect(0,0,t,e),this},e.prototype.drawRect=function(t,e,n){void 0===n&&(n="black"),this.context.save(),this.context.fillStyle=n,this.context.fillRect(t.x,t.y,e.x,e.y),this.context.restore()},e.prototype.drawGameImage=function(t,e){var n=e.x,i=e.y;this.context.drawImage(t.img,n,i)},e.prototype.drawTile=function(t,e){var n=e.x,i=e.y,o=t.size,r=o.x,s=o.y,a=t.positionInImage,l=a.x,c=a.y;this.context.drawImage(t.gameImage.img,l,c,r,s,n,i,r,s)},e.prototype.drawGameImageByCenter=function(t,e){var n=e.x,i=e.y,o=n-t.img.width/2,r=i-t.img.height/2;this.context.drawImage(t.img,o,r)},e.prototype.drawTileByCenter=function(t,e){var n=e.x,i=e.y,o=t.size,r=o.x,s=o.y,a=n-r/2,l=i-s/2,c=t.positionInImage,u=c.x,p=c.y;this.context.drawImage(t.gameImage.img,u,p,r,s,a,l,r,s)},e}(n(0).EventEmitter);e.default=r},function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(o,r){function s(t){try{l(i.next(t))}catch(t){r(t)}}function a(t){try{l(i.throw(t))}catch(t){r(t)}}function l(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(s,a)}l((i=i.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){var n,i,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}};e.__esModule=!0;var r=n(14),s=n(40),a=n(41);!function(){i(this,void 0,void 0,function(){var t;return o(this,function(e){switch(e.label){case 0:return[4,(t=new r.default).load()];case 1:return e.sent(),t.init(),a.default&&s.init(t),t.run(),[2]}})})}()},function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(o,r){function s(t){try{l(i.next(t))}catch(t){r(t)}}function a(t){try{l(i.throw(t))}catch(t){r(t)}}function l(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(s,a)}l((i=i.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){var n,i,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}};e.__esModule=!0;var r=n(3),s=n(7),a=n(30),l=n(12),c=n(0),u=n(31),p=n(5),d=n(32),f=n(36),h=n(37),y=n(39),m=n(8),v=function(){function t(){this.mainloop=new a.Mainloop(this),this.canvas=new l.default,this.gameCamera=new u.default(this.canvas),this.physicsEngine=new p.default(this.mainloop),this.eventManager=new f.default,this.entitiesManager=new y.default(this.gameCamera),this.player=new d.default(this),this.map1=new h.default("/assets/tiled/map-1.json",this.canvas)}return t.prototype.load=function(){return i(this,void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return[4,Promise.all([r.loadAllImages(),this.map1.load()])];case 1:return t.sent(),[2,this]}})})},t.prototype.init=function(){s.init(this),this.canvas.create().appendTo("body").alwaysFullscreen(),this.physicsEngine.create().noGravity(),this.eventManager.init().noContextMenu(),this.gameCamera.init().setScale(new c.Victor(2,2)),this.map1.setBodiesContainer(this.physicsEngine.world).setGameCamera(this.gameCamera),this.map1.makeCacheFromVisibleLayers(),this.map1.addStaticObjectsFromObjectLayer("collision");for(var t=this.map1.getObjectLayer("entities"),e=new c.Victor(0,0),n=0,i=t.objects;n<i.length;n++){var o=i[n];if(e.x=o.x+o.width/2,e.y=o.y+o.height/2,"door"===o.name){var r=new m.default(this);r.init(),r.setPosition(e),this.entitiesManager.addEntity(r)}}return this.player.init(),this.gameCamera.follow(this.player.entity.getPosition()),this},t.prototype.update=function(){return this.entitiesManager.update(),this.gameCamera.update(),this.physicsEngine.update(),this.draw(),this},t.prototype.draw=function(){return this.canvas.clear(),this.gameCamera.begin(),this.map1.drawFromCache(),this.entitiesManager.draw(),this.gameCamera.end(),this},t.prototype.run=function(){return this.mainloop.run(),this},t}();e.default=v},function(t,e){function n(t,e){if(!(this instanceof n))return new n(t,e);this.x=t||0,this.y=e||0}t.exports=n,n.fromArray=function(t){return new n(t[0]||0,t[1]||0)},n.fromObject=function(t){return new n(t.x||0,t.y||0)},n.prototype.addX=function(t){return this.x+=t.x,this},n.prototype.addY=function(t){return this.y+=t.y,this},n.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},n.prototype.addScalar=function(t){return this.x+=t,this.y+=t,this},n.prototype.addScalarX=function(t){return this.x+=t,this},n.prototype.addScalarY=function(t){return this.y+=t,this},n.prototype.subtractX=function(t){return this.x-=t.x,this},n.prototype.subtractY=function(t){return this.y-=t.y,this},n.prototype.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},n.prototype.subtractScalar=function(t){return this.x-=t,this.y-=t,this},n.prototype.subtractScalarX=function(t){return this.x-=t,this},n.prototype.subtractScalarY=function(t){return this.y-=t,this},n.prototype.divideX=function(t){return this.x/=t.x,this},n.prototype.divideY=function(t){return this.y/=t.y,this},n.prototype.divide=function(t){return this.x/=t.x,this.y/=t.y,this},n.prototype.divideScalar=function(t){return 0!==t?(this.x/=t,this.y/=t):(this.x=0,this.y=0),this},n.prototype.divideScalarX=function(t){return 0!==t?this.x/=t:this.x=0,this},n.prototype.divideScalarY=function(t){return 0!==t?this.y/=t:this.y=0,this},n.prototype.invertX=function(){return this.x*=-1,this},n.prototype.invertY=function(){return this.y*=-1,this},n.prototype.invert=function(){return this.invertX(),this.invertY(),this},n.prototype.multiplyX=function(t){return this.x*=t.x,this},n.prototype.multiplyY=function(t){return this.y*=t.y,this},n.prototype.multiply=function(t){return this.x*=t.x,this.y*=t.y,this},n.prototype.multiplyScalar=function(t){return this.x*=t,this.y*=t,this},n.prototype.multiplyScalarX=function(t){return this.x*=t,this},n.prototype.multiplyScalarY=function(t){return this.y*=t,this},n.prototype.normalize=function(){var t=this.length();return 0===t?(this.x=1,this.y=0):this.divide(n(t,t)),this},n.prototype.norm=n.prototype.normalize,n.prototype.limit=function(t,e){return Math.abs(this.x)>t&&(this.x*=e),Math.abs(this.y)>t&&(this.y*=e),this},n.prototype.randomize=function(t,e){return this.randomizeX(t,e),this.randomizeY(t,e),this},n.prototype.randomizeX=function(t,e){var n=Math.min(t.x,e.x),i=Math.max(t.x,e.x);return this.x=o(n,i),this},n.prototype.randomizeY=function(t,e){var n=Math.min(t.y,e.y),i=Math.max(t.y,e.y);return this.y=o(n,i),this},n.prototype.randomizeAny=function(t,e){return Math.round(Math.random())?this.randomizeX(t,e):this.randomizeY(t,e),this},n.prototype.unfloat=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},n.prototype.toFixed=function(t){return void 0===t&&(t=8),this.x=this.x.toFixed(t),this.y=this.y.toFixed(t),this},n.prototype.mixX=function(t,e){return void 0===e&&(e=.5),this.x=(1-e)*this.x+e*t.x,this},n.prototype.mixY=function(t,e){return void 0===e&&(e=.5),this.y=(1-e)*this.y+e*t.y,this},n.prototype.mix=function(t,e){return this.mixX(t,e),this.mixY(t,e),this},n.prototype.clone=function(){return new n(this.x,this.y)},n.prototype.copyX=function(t){return this.x=t.x,this},n.prototype.copyY=function(t){return this.y=t.y,this},n.prototype.copy=function(t){return this.copyX(t),this.copyY(t),this},n.prototype.zero=function(){return this.x=this.y=0,this},n.prototype.dot=function(t){return this.x*t.x+this.y*t.y},n.prototype.cross=function(t){return this.x*t.y-this.y*t.x},n.prototype.projectOnto=function(t){var e=(this.x*t.x+this.y*t.y)/(t.x*t.x+t.y*t.y);return this.x=e*t.x,this.y=e*t.y,this},n.prototype.horizontalAngle=function(){return Math.atan2(this.y,this.x)},n.prototype.horizontalAngleDeg=function(){return r(this.horizontalAngle())},n.prototype.verticalAngle=function(){return Math.atan2(this.x,this.y)},n.prototype.verticalAngleDeg=function(){return r(this.verticalAngle())},n.prototype.angle=n.prototype.horizontalAngle,n.prototype.angleDeg=n.prototype.horizontalAngleDeg,n.prototype.direction=n.prototype.horizontalAngle,n.prototype.rotate=function(t){var e=this.x*Math.cos(t)-this.y*Math.sin(t),n=this.x*Math.sin(t)+this.y*Math.cos(t);return this.x=e,this.y=n,this},n.prototype.rotateDeg=function(t){return t=s(t),this.rotate(t)},n.prototype.rotateTo=function(t){return this.rotate(t-this.angle())},n.prototype.rotateToDeg=function(t){return t=s(t),this.rotateTo(t)},n.prototype.rotateBy=function(t){var e=this.angle()+t;return this.rotate(e)},n.prototype.rotateByDeg=function(t){return t=s(t),this.rotateBy(t)},n.prototype.distanceX=function(t){return this.x-t.x},n.prototype.absDistanceX=function(t){return Math.abs(this.distanceX(t))},n.prototype.distanceY=function(t){return this.y-t.y},n.prototype.absDistanceY=function(t){return Math.abs(this.distanceY(t))},n.prototype.distance=function(t){return Math.sqrt(this.distanceSq(t))},n.prototype.distanceSq=function(t){var e=this.distanceX(t),n=this.distanceY(t);return e*e+n*n},n.prototype.length=function(){return Math.sqrt(this.lengthSq())},n.prototype.lengthSq=function(){return this.x*this.x+this.y*this.y},n.prototype.magnitude=n.prototype.length,n.prototype.isZero=function(){return 0===this.x&&0===this.y},n.prototype.isEqualTo=function(t){return this.x===t.x&&this.y===t.y},n.prototype.toString=function(){return"x:"+this.x+", y:"+this.y},n.prototype.toArray=function(){return[this.x,this.y]},n.prototype.toObject=function(){return{x:this.x,y:this.y}};var i=180/Math.PI;function o(t,e){return Math.floor(Math.random()*(e-t+1)+t)}function r(t){return t*i}function s(t){return t/i}},function(t,e,n){(function(e){var n;t.exports=function t(e,i,o){function r(a,l){if(!i[a]){if(!e[a]){var c="function"==typeof n&&n;if(!l&&c)return n(a,!0);if(s)return s(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var p=i[a]={exports:{}};e[a][0].call(p.exports,function(t){var n=e[a][1][t];return r(n||t)},p,p.exports,t,e,i,o)}return i[a].exports}for(var s="function"==typeof n&&n,a=0;a<o.length;a++)r(o[a]);return r}({1:[function(t,e,n){var i={};e.exports=i;var o=t("../geometry/Vertices"),r=t("../geometry/Vector"),s=t("../core/Sleeping"),a=(t("../render/Render"),t("../core/Common")),l=t("../geometry/Bounds"),c=t("../geometry/Axes");!function(){i._inertiaScale=4,i._nextCollidingGroupId=1,i._nextNonCollidingGroupId=-1,i._nextCategory=1,i.create=function(e){var n={id:a.nextId(),type:"body",label:"Body",parts:[],plugin:{},angle:0,vertices:o.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0},lineWidth:0}},i=a.extend(n,e);return t(i,e),i},i.nextGroup=function(t){return t?i._nextNonCollidingGroupId--:i._nextCollidingGroupId++},i.nextCategory=function(){return i._nextCategory=i._nextCategory<<1,i._nextCategory};var t=function(t,e){e=e||{},i.set(t,{bounds:t.bounds||l.create(t.vertices),positionPrev:t.positionPrev||r.clone(t.position),anglePrev:t.anglePrev||t.angle,vertices:t.vertices,parts:t.parts||[t],isStatic:t.isStatic,isSleeping:t.isSleeping,parent:t.parent||t}),o.rotate(t.vertices,t.angle,t.position),c.rotate(t.axes,t.angle),l.update(t.bounds,t.vertices,t.velocity),i.set(t,{axes:e.axes||t.axes,area:e.area||t.area,mass:e.mass||t.mass,inertia:e.inertia||t.inertia});var n=t.isStatic?"#2e2b44":a.choose(["#006BA6","#0496FF","#FFBC42","#D81159","#8F2D56"]);t.render.fillStyle=t.render.fillStyle||n,t.render.strokeStyle=t.render.strokeStyle||"#000",t.render.sprite.xOffset+=-(t.bounds.min.x-t.position.x)/(t.bounds.max.x-t.bounds.min.x),t.render.sprite.yOffset+=-(t.bounds.min.y-t.position.y)/(t.bounds.max.y-t.bounds.min.y)};i.set=function(t,e,n){var o;for(o in"string"==typeof e&&(o=e,(e={})[o]=n),e)if(n=e[o],e.hasOwnProperty(o))switch(o){case"isStatic":i.setStatic(t,n);break;case"isSleeping":s.set(t,n);break;case"mass":i.setMass(t,n);break;case"density":i.setDensity(t,n);break;case"inertia":i.setInertia(t,n);break;case"vertices":i.setVertices(t,n);break;case"position":i.setPosition(t,n);break;case"angle":i.setAngle(t,n);break;case"velocity":i.setVelocity(t,n);break;case"angularVelocity":i.setAngularVelocity(t,n);break;case"parts":i.setParts(t,n);break;default:t[o]=n}},i.setStatic=function(t,e){for(var n=0;n<t.parts.length;n++){var i=t.parts[n];i.isStatic=e,e?(i._original={restitution:i.restitution,friction:i.friction,mass:i.mass,inertia:i.inertia,density:i.density,inverseMass:i.inverseMass,inverseInertia:i.inverseInertia},i.restitution=0,i.friction=1,i.mass=i.inertia=i.density=1/0,i.inverseMass=i.inverseInertia=0,i.positionPrev.x=i.position.x,i.positionPrev.y=i.position.y,i.anglePrev=i.angle,i.angularVelocity=0,i.speed=0,i.angularSpeed=0,i.motion=0):i._original&&(i.restitution=i._original.restitution,i.friction=i._original.friction,i.mass=i._original.mass,i.inertia=i._original.inertia,i.density=i._original.density,i.inverseMass=i._original.inverseMass,i.inverseInertia=i._original.inverseInertia,delete i._original)}},i.setMass=function(t,e){var n=t.inertia/(t.mass/6);t.inertia=n*(e/6),t.inverseInertia=1/t.inertia,t.mass=e,t.inverseMass=1/t.mass,t.density=t.mass/t.area},i.setDensity=function(t,e){i.setMass(t,e*t.area),t.density=e},i.setInertia=function(t,e){t.inertia=e,t.inverseInertia=1/t.inertia},i.setVertices=function(t,e){e[0].body===t?t.vertices=e:t.vertices=o.create(e,t),t.axes=c.fromVertices(t.vertices),t.area=o.area(t.vertices),i.setMass(t,t.density*t.area);var n=o.centre(t.vertices);o.translate(t.vertices,n,-1),i.setInertia(t,i._inertiaScale*o.inertia(t.vertices,t.mass)),o.translate(t.vertices,t.position),l.update(t.bounds,t.vertices,t.velocity)},i.setParts=function(t,e,n){var r;for(e=e.slice(0),t.parts.length=0,t.parts.push(t),t.parent=t,r=0;r<e.length;r++){var s=e[r];s!==t&&(s.parent=t,t.parts.push(s))}if(1!==t.parts.length){if(n=void 0===n||n){var a=[];for(r=0;r<e.length;r++)a=a.concat(e[r].vertices);o.clockwiseSort(a);var l=o.hull(a),c=o.centre(l);i.setVertices(t,l),o.translate(t.vertices,c)}var u=i._totalProperties(t);t.area=u.area,t.parent=t,t.position.x=u.centre.x,t.position.y=u.centre.y,t.positionPrev.x=u.centre.x,t.positionPrev.y=u.centre.y,i.setMass(t,u.mass),i.setInertia(t,u.inertia),i.setPosition(t,u.centre)}},i.setPosition=function(t,e){var n=r.sub(e,t.position);t.positionPrev.x+=n.x,t.positionPrev.y+=n.y;for(var i=0;i<t.parts.length;i++){var s=t.parts[i];s.position.x+=n.x,s.position.y+=n.y,o.translate(s.vertices,n),l.update(s.bounds,s.vertices,t.velocity)}},i.setAngle=function(t,e){var n=e-t.angle;t.anglePrev+=n;for(var i=0;i<t.parts.length;i++){var s=t.parts[i];s.angle+=n,o.rotate(s.vertices,n,t.position),c.rotate(s.axes,n),l.update(s.bounds,s.vertices,t.velocity),i>0&&r.rotateAbout(s.position,n,t.position,s.position)}},i.setVelocity=function(t,e){t.positionPrev.x=t.position.x-e.x,t.positionPrev.y=t.position.y-e.y,t.velocity.x=e.x,t.velocity.y=e.y,t.speed=r.magnitude(t.velocity)},i.setAngularVelocity=function(t,e){t.anglePrev=t.angle-e,t.angularVelocity=e,t.angularSpeed=Math.abs(t.angularVelocity)},i.translate=function(t,e){i.setPosition(t,r.add(t.position,e))},i.rotate=function(t,e,n){if(n){var o=Math.cos(e),r=Math.sin(e),s=t.position.x-n.x,a=t.position.y-n.y;i.setPosition(t,{x:n.x+(s*o-a*r),y:n.y+(s*r+a*o)}),i.setAngle(t,t.angle+e)}else i.setAngle(t,t.angle+e)},i.scale=function(t,e,n,r){var s=0,a=0;r=r||t.position;for(var u=0;u<t.parts.length;u++){var p=t.parts[u];o.scale(p.vertices,e,n,r),p.axes=c.fromVertices(p.vertices),p.area=o.area(p.vertices),i.setMass(p,t.density*p.area),o.translate(p.vertices,{x:-p.position.x,y:-p.position.y}),i.setInertia(p,i._inertiaScale*o.inertia(p.vertices,p.mass)),o.translate(p.vertices,{x:p.position.x,y:p.position.y}),u>0&&(s+=p.area,a+=p.inertia),p.position.x=r.x+(p.position.x-r.x)*e,p.position.y=r.y+(p.position.y-r.y)*n,l.update(p.bounds,p.vertices,t.velocity)}t.parts.length>1&&(t.area=s,t.isStatic||(i.setMass(t,t.density*s),i.setInertia(t,a))),t.circleRadius&&(e===n?t.circleRadius*=e:t.circleRadius=null)},i.update=function(t,e,n,i){var s=Math.pow(e*n*t.timeScale,2),a=1-t.frictionAir*n*t.timeScale,u=t.position.x-t.positionPrev.x,p=t.position.y-t.positionPrev.y;t.velocity.x=u*a*i+t.force.x/t.mass*s,t.velocity.y=p*a*i+t.force.y/t.mass*s,t.positionPrev.x=t.position.x,t.positionPrev.y=t.position.y,t.position.x+=t.velocity.x,t.position.y+=t.velocity.y,t.angularVelocity=(t.angle-t.anglePrev)*a*i+t.torque/t.inertia*s,t.anglePrev=t.angle,t.angle+=t.angularVelocity,t.speed=r.magnitude(t.velocity),t.angularSpeed=Math.abs(t.angularVelocity);for(var d=0;d<t.parts.length;d++){var f=t.parts[d];o.translate(f.vertices,t.velocity),d>0&&(f.position.x+=t.velocity.x,f.position.y+=t.velocity.y),0!==t.angularVelocity&&(o.rotate(f.vertices,t.angularVelocity,t.position),c.rotate(f.axes,t.angularVelocity),d>0&&r.rotateAbout(f.position,t.angularVelocity,t.position,f.position)),l.update(f.bounds,f.vertices,t.velocity)}},i.applyForce=function(t,e,n){t.force.x+=n.x,t.force.y+=n.y;var i={x:e.x-t.position.x,y:e.y-t.position.y};t.torque+=i.x*n.y-i.y*n.x},i._totalProperties=function(t){for(var e={mass:0,area:0,inertia:0,centre:{x:0,y:0}},n=1===t.parts.length?0:1;n<t.parts.length;n++){var i=t.parts[n],o=i.mass!==1/0?i.mass:1;e.mass+=o,e.area+=i.area,e.inertia+=i.inertia,e.centre=r.add(e.centre,r.mult(i.position,o))}return e.centre=r.div(e.centre,e.mass),e}}()},{"../core/Common":14,"../core/Sleeping":22,"../geometry/Axes":25,"../geometry/Bounds":26,"../geometry/Vector":28,"../geometry/Vertices":29,"../render/Render":31}],2:[function(t,e,n){var i={};e.exports=i;var o=t("../core/Events"),r=t("../core/Common"),s=t("../geometry/Bounds"),a=t("./Body");i.create=function(t){return r.extend({id:r.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite",plugin:{}},t)},i.setModified=function(t,e,n,o){if(t.isModified=e,n&&t.parent&&i.setModified(t.parent,e,n,o),o)for(var r=0;r<t.composites.length;r++){var s=t.composites[r];i.setModified(s,e,n,o)}},i.add=function(t,e){var n=[].concat(e);o.trigger(t,"beforeAdd",{object:e});for(var s=0;s<n.length;s++){var a=n[s];switch(a.type){case"body":if(a.parent!==a){r.warn("Composite.add: skipped adding a compound body part (you must add its parent instead)");break}i.addBody(t,a);break;case"constraint":i.addConstraint(t,a);break;case"composite":i.addComposite(t,a);break;case"mouseConstraint":i.addConstraint(t,a.constraint)}}return o.trigger(t,"afterAdd",{object:e}),t},i.remove=function(t,e,n){var r=[].concat(e);o.trigger(t,"beforeRemove",{object:e});for(var s=0;s<r.length;s++){var a=r[s];switch(a.type){case"body":i.removeBody(t,a,n);break;case"constraint":i.removeConstraint(t,a,n);break;case"composite":i.removeComposite(t,a,n);break;case"mouseConstraint":i.removeConstraint(t,a.constraint)}}return o.trigger(t,"afterRemove",{object:e}),t},i.addComposite=function(t,e){return t.composites.push(e),e.parent=t,i.setModified(t,!0,!0,!1),t},i.removeComposite=function(t,e,n){var o=r.indexOf(t.composites,e);if(-1!==o&&(i.removeCompositeAt(t,o),i.setModified(t,!0,!0,!1)),n)for(var s=0;s<t.composites.length;s++)i.removeComposite(t.composites[s],e,!0);return t},i.removeCompositeAt=function(t,e){return t.composites.splice(e,1),i.setModified(t,!0,!0,!1),t},i.addBody=function(t,e){return t.bodies.push(e),i.setModified(t,!0,!0,!1),t},i.removeBody=function(t,e,n){var o=r.indexOf(t.bodies,e);if(-1!==o&&(i.removeBodyAt(t,o),i.setModified(t,!0,!0,!1)),n)for(var s=0;s<t.composites.length;s++)i.removeBody(t.composites[s],e,!0);return t},i.removeBodyAt=function(t,e){return t.bodies.splice(e,1),i.setModified(t,!0,!0,!1),t},i.addConstraint=function(t,e){return t.constraints.push(e),i.setModified(t,!0,!0,!1),t},i.removeConstraint=function(t,e,n){var o=r.indexOf(t.constraints,e);if(-1!==o&&i.removeConstraintAt(t,o),n)for(var s=0;s<t.composites.length;s++)i.removeConstraint(t.composites[s],e,!0);return t},i.removeConstraintAt=function(t,e){return t.constraints.splice(e,1),i.setModified(t,!0,!0,!1),t},i.clear=function(t,e,n){if(n)for(var o=0;o<t.composites.length;o++)i.clear(t.composites[o],e,!0);return e?t.bodies=t.bodies.filter(function(t){return t.isStatic}):t.bodies.length=0,t.constraints.length=0,t.composites.length=0,i.setModified(t,!0,!0,!1),t},i.allBodies=function(t){for(var e=[].concat(t.bodies),n=0;n<t.composites.length;n++)e=e.concat(i.allBodies(t.composites[n]));return e},i.allConstraints=function(t){for(var e=[].concat(t.constraints),n=0;n<t.composites.length;n++)e=e.concat(i.allConstraints(t.composites[n]));return e},i.allComposites=function(t){for(var e=[].concat(t.composites),n=0;n<t.composites.length;n++)e=e.concat(i.allComposites(t.composites[n]));return e},i.get=function(t,e,n){var o,r;switch(n){case"body":o=i.allBodies(t);break;case"constraint":o=i.allConstraints(t);break;case"composite":o=i.allComposites(t).concat(t)}return o?0===(r=o.filter(function(t){return t.id.toString()===e.toString()})).length?null:r[0]:null},i.move=function(t,e,n){return i.remove(t,e),i.add(n,e),t},i.rebase=function(t){for(var e=i.allBodies(t).concat(i.allConstraints(t)).concat(i.allComposites(t)),n=0;n<e.length;n++)e[n].id=r.nextId();return i.setModified(t,!0,!0,!1),t},i.translate=function(t,e,n){for(var o=n?i.allBodies(t):t.bodies,r=0;r<o.length;r++)a.translate(o[r],e);return i.setModified(t,!0,!0,!1),t},i.rotate=function(t,e,n,o){for(var r=Math.cos(e),s=Math.sin(e),l=o?i.allBodies(t):t.bodies,c=0;c<l.length;c++){var u=l[c],p=u.position.x-n.x,d=u.position.y-n.y;a.setPosition(u,{x:n.x+(p*r-d*s),y:n.y+(p*s+d*r)}),a.rotate(u,e)}return i.setModified(t,!0,!0,!1),t},i.scale=function(t,e,n,o,r){for(var s=r?i.allBodies(t):t.bodies,l=0;l<s.length;l++){var c=s[l],u=c.position.x-o.x,p=c.position.y-o.y;a.setPosition(c,{x:o.x+u*e,y:o.y+p*n}),a.scale(c,e,n)}return i.setModified(t,!0,!0,!1),t},i.bounds=function(t){for(var e=i.allBodies(t),n=[],o=0;o<e.length;o+=1){var r=e[o];n.push(r.bounds.min,r.bounds.max)}return s.create(n)}},{"../core/Common":14,"../core/Events":16,"../geometry/Bounds":26,"./Body":1}],3:[function(t,e,n){var i={};e.exports=i;var o=t("./Composite"),r=(t("../constraint/Constraint"),t("../core/Common"));i.create=function(t){var e=o.create(),n={label:"World",gravity:{x:0,y:1,scale:.001},bounds:{min:{x:-1/0,y:-1/0},max:{x:1/0,y:1/0}}};return r.extend(e,n,t)}},{"../constraint/Constraint":12,"../core/Common":14,"./Composite":2}],4:[function(t,e,n){var i={};e.exports=i,i.create=function(t){return{id:i.id(t),vertex:t,normalImpulse:0,tangentImpulse:0}},i.id=function(t){return t.body.id+"_"+t.index}},{}],5:[function(t,e,n){var i={};e.exports=i;var o=t("./SAT"),r=t("./Pair"),s=t("../geometry/Bounds");i.collisions=function(t,e){for(var n=[],a=e.pairs.table,l=0;l<t.length;l++){var c=t[l][0],u=t[l][1];if((!c.isStatic&&!c.isSleeping||!u.isStatic&&!u.isSleeping)&&i.canCollide(c.collisionFilter,u.collisionFilter)&&s.overlaps(c.bounds,u.bounds))for(var p=c.parts.length>1?1:0;p<c.parts.length;p++)for(var d=c.parts[p],f=u.parts.length>1?1:0;f<u.parts.length;f++){var h=u.parts[f];if(d===c&&h===u||s.overlaps(d.bounds,h.bounds)){var y,m=r.id(d,h),v=a[m];y=v&&v.isActive?v.collision:null;var g=o.collides(d,h,y);g.collided&&n.push(g)}}}return n},i.canCollide=function(t,e){return t.group===e.group&&0!==t.group?t.group>0:0!=(t.mask&e.category)&&0!=(e.mask&t.category)}},{"../geometry/Bounds":26,"./Pair":7,"./SAT":11}],6:[function(t,e,n){var i={};e.exports=i;var o=t("./Pair"),r=t("./Detector"),s=t("../core/Common");i.create=function(t){var e={controller:i,detector:r.collisions,buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48};return s.extend(e,t)},i.update=function(t,e,n,o){var r,s,a,l,c,u=n.world,p=t.buckets,d=!1;for(r=0;r<e.length;r++){var f=e[r];if((!f.isSleeping||o)&&!(f.bounds.max.x<u.bounds.min.x||f.bounds.min.x>u.bounds.max.x||f.bounds.max.y<u.bounds.min.y||f.bounds.min.y>u.bounds.max.y)){var h=i._getRegion(t,f);if(!f.region||h.id!==f.region.id||o){f.region&&!o||(f.region=h);var y=i._regionUnion(h,f.region);for(s=y.startCol;s<=y.endCol;s++)for(a=y.startRow;a<=y.endRow;a++){c=i._getBucketId(s,a),l=p[c];var m=s>=h.startCol&&s<=h.endCol&&a>=h.startRow&&a<=h.endRow,v=s>=f.region.startCol&&s<=f.region.endCol&&a>=f.region.startRow&&a<=f.region.endRow;!m&&v&&v&&l&&i._bucketRemoveBody(t,l,f),(f.region===h||m&&!v||o)&&(l||(l=i._createBucket(p,c)),i._bucketAddBody(t,l,f))}f.region=h,d=!0}}}d&&(t.pairsList=i._createActivePairsList(t))},i.clear=function(t){t.buckets={},t.pairs={},t.pairsList=[]},i._regionUnion=function(t,e){var n=Math.min(t.startCol,e.startCol),o=Math.max(t.endCol,e.endCol),r=Math.min(t.startRow,e.startRow),s=Math.max(t.endRow,e.endRow);return i._createRegion(n,o,r,s)},i._getRegion=function(t,e){var n=e.bounds,o=Math.floor(n.min.x/t.bucketWidth),r=Math.floor(n.max.x/t.bucketWidth),s=Math.floor(n.min.y/t.bucketHeight),a=Math.floor(n.max.y/t.bucketHeight);return i._createRegion(o,r,s,a)},i._createRegion=function(t,e,n,i){return{id:t+","+e+","+n+","+i,startCol:t,endCol:e,startRow:n,endRow:i}},i._getBucketId=function(t,e){return"C"+t+"R"+e},i._createBucket=function(t,e){var n=t[e]=[];return n},i._bucketAddBody=function(t,e,n){for(var i=0;i<e.length;i++){var r=e[i];if(!(n.id===r.id||n.isStatic&&r.isStatic)){var s=o.id(n,r),a=t.pairs[s];a?a[2]+=1:t.pairs[s]=[n,r,1]}}e.push(n)},i._bucketRemoveBody=function(t,e,n){e.splice(s.indexOf(e,n),1);for(var i=0;i<e.length;i++){var r=e[i],a=o.id(n,r),l=t.pairs[a];l&&(l[2]-=1)}},i._createActivePairsList=function(t){var e,n,i=[];e=s.keys(t.pairs);for(var o=0;o<e.length;o++)(n=t.pairs[e[o]])[2]>0?i.push(n):delete t.pairs[e[o]];return i}},{"../core/Common":14,"./Detector":5,"./Pair":7}],7:[function(t,e,n){var i={};e.exports=i;var o=t("./Contact");i.create=function(t,e){var n=t.bodyA,o=t.bodyB,r=t.parentA,s=t.parentB,a={id:i.id(n,o),bodyA:n,bodyB:o,contacts:{},activeContacts:[],separation:0,isActive:!0,isSensor:n.isSensor||o.isSensor,timeCreated:e,timeUpdated:e,inverseMass:r.inverseMass+s.inverseMass,friction:Math.min(r.friction,s.friction),frictionStatic:Math.max(r.frictionStatic,s.frictionStatic),restitution:Math.max(r.restitution,s.restitution),slop:Math.max(r.slop,s.slop)};return i.update(a,t,e),a},i.update=function(t,e,n){var r=t.contacts,s=e.supports,a=t.activeContacts,l=e.parentA,c=e.parentB;if(t.collision=e,t.inverseMass=l.inverseMass+c.inverseMass,t.friction=Math.min(l.friction,c.friction),t.frictionStatic=Math.max(l.frictionStatic,c.frictionStatic),t.restitution=Math.max(l.restitution,c.restitution),t.slop=Math.max(l.slop,c.slop),a.length=0,e.collided){for(var u=0;u<s.length;u++){var p=s[u],d=o.id(p),f=r[d];f?a.push(f):a.push(r[d]=o.create(p))}t.separation=e.depth,i.setActive(t,!0,n)}else!0===t.isActive&&i.setActive(t,!1,n)},i.setActive=function(t,e,n){e?(t.isActive=!0,t.timeUpdated=n):(t.isActive=!1,t.activeContacts.length=0)},i.id=function(t,e){return t.id<e.id?"A"+t.id+"B"+e.id:"A"+e.id+"B"+t.id}},{"./Contact":4}],8:[function(t,e,n){var i={};e.exports=i;var o=t("./Pair"),r=t("../core/Common");i._pairMaxIdleLife=1e3,i.create=function(t){return r.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},t)},i.update=function(t,e,n){var i,s,a,l,c=t.list,u=t.table,p=t.collisionStart,d=t.collisionEnd,f=t.collisionActive,h=[];for(p.length=0,d.length=0,f.length=0,l=0;l<e.length;l++)(i=e[l]).collided&&(s=o.id(i.bodyA,i.bodyB),h.push(s),(a=u[s])?(a.isActive?f.push(a):p.push(a),o.update(a,i,n)):(a=o.create(i,n),u[s]=a,p.push(a),c.push(a)));for(l=0;l<c.length;l++)(a=c[l]).isActive&&-1===r.indexOf(h,a.id)&&(o.setActive(a,!1,n),d.push(a))},i.removeOld=function(t,e){var n,o,r,s,a=t.list,l=t.table,c=[];for(s=0;s<a.length;s++)n=a[s],(o=n.collision).bodyA.isSleeping||o.bodyB.isSleeping?n.timeUpdated=e:e-n.timeUpdated>i._pairMaxIdleLife&&c.push(s);for(s=0;s<c.length;s++)r=c[s]-s,n=a[r],delete l[n.id],a.splice(r,1)},i.clear=function(t){return t.table={},t.list.length=0,t.collisionStart.length=0,t.collisionActive.length=0,t.collisionEnd.length=0,t}},{"../core/Common":14,"./Pair":7}],9:[function(t,e,n){var i={};e.exports=i;var o=t("../geometry/Vector"),r=t("./SAT"),s=t("../geometry/Bounds"),a=t("../factory/Bodies"),l=t("../geometry/Vertices");i.collides=function(t,e){for(var n=[],i=0;i<e.length;i++){var o=e[i];if(s.overlaps(o.bounds,t.bounds))for(var a=1===o.parts.length?0:1;a<o.parts.length;a++){var l=o.parts[a];if(s.overlaps(l.bounds,t.bounds)){var c=r.collides(l,t);if(c.collided){n.push(c);break}}}}return n},i.ray=function(t,e,n,r){r=r||1e-100;for(var s=o.angle(e,n),l=o.magnitude(o.sub(e,n)),c=.5*(n.x+e.x),u=.5*(n.y+e.y),p=a.rectangle(c,u,l,r,{angle:s}),d=i.collides(p,t),f=0;f<d.length;f+=1){var h=d[f];h.body=h.bodyB=h.bodyA}return d},i.region=function(t,e,n){for(var i=[],o=0;o<t.length;o++){var r=t[o],a=s.overlaps(r.bounds,e);(a&&!n||!a&&n)&&i.push(r)}return i},i.point=function(t,e){for(var n=[],i=0;i<t.length;i++){var o=t[i];if(s.contains(o.bounds,e))for(var r=1===o.parts.length?0:1;r<o.parts.length;r++){var a=o.parts[r];if(s.contains(a.bounds,e)&&l.contains(a.vertices,e)){n.push(o);break}}}return n}},{"../factory/Bodies":23,"../geometry/Bounds":26,"../geometry/Vector":28,"../geometry/Vertices":29,"./SAT":11}],10:[function(t,e,n){var i={};e.exports=i;var o=t("../geometry/Vertices"),r=t("../geometry/Vector"),s=t("../core/Common"),a=t("../geometry/Bounds");i._restingThresh=4,i._restingThreshTangent=6,i._positionDampen=.9,i._positionWarming=.8,i._frictionNormalMultiplier=5,i.preSolvePosition=function(t){var e,n,i;for(e=0;e<t.length;e++)(n=t[e]).isActive&&(i=n.activeContacts.length,n.collision.parentA.totalContacts+=i,n.collision.parentB.totalContacts+=i)},i.solvePosition=function(t,e){var n,o,s,a,l,c,u,p,d,f=r._temp[0],h=r._temp[1],y=r._temp[2],m=r._temp[3];for(n=0;n<t.length;n++)(o=t[n]).isActive&&!o.isSensor&&(s=o.collision,a=s.parentA,l=s.parentB,c=s.normal,u=r.sub(r.add(l.positionImpulse,l.position,f),r.add(a.positionImpulse,r.sub(l.position,s.penetration,h),y),m),o.separation=r.dot(c,u));for(n=0;n<t.length;n++)(o=t[n]).isActive&&!o.isSensor&&(s=o.collision,a=s.parentA,l=s.parentB,c=s.normal,d=(o.separation-o.slop)*e,(a.isStatic||l.isStatic)&&(d*=2),a.isStatic||a.isSleeping||(p=i._positionDampen/a.totalContacts,a.positionImpulse.x+=c.x*d*p,a.positionImpulse.y+=c.y*d*p),l.isStatic||l.isSleeping||(p=i._positionDampen/l.totalContacts,l.positionImpulse.x-=c.x*d*p,l.positionImpulse.y-=c.y*d*p))},i.postSolvePosition=function(t){for(var e=0;e<t.length;e++){var n=t[e];if(n.totalContacts=0,0!==n.positionImpulse.x||0!==n.positionImpulse.y){for(var s=0;s<n.parts.length;s++){var l=n.parts[s];o.translate(l.vertices,n.positionImpulse),a.update(l.bounds,l.vertices,n.velocity),l.position.x+=n.positionImpulse.x,l.position.y+=n.positionImpulse.y}n.positionPrev.x+=n.positionImpulse.x,n.positionPrev.y+=n.positionImpulse.y,r.dot(n.positionImpulse,n.velocity)<0?(n.positionImpulse.x=0,n.positionImpulse.y=0):(n.positionImpulse.x*=i._positionWarming,n.positionImpulse.y*=i._positionWarming)}}},i.preSolveVelocity=function(t){var e,n,i,o,s,a,l,c,u,p,d,f,h,y,m=r._temp[0],v=r._temp[1];for(e=0;e<t.length;e++)if((i=t[e]).isActive&&!i.isSensor)for(o=i.activeContacts,s=i.collision,a=s.parentA,l=s.parentB,c=s.normal,u=s.tangent,n=0;n<o.length;n++)p=o[n],d=p.vertex,f=p.normalImpulse,h=p.tangentImpulse,0===f&&0===h||(m.x=c.x*f+u.x*h,m.y=c.y*f+u.y*h,a.isStatic||a.isSleeping||(y=r.sub(d,a.position,v),a.positionPrev.x+=m.x*a.inverseMass,a.positionPrev.y+=m.y*a.inverseMass,a.anglePrev+=r.cross(y,m)*a.inverseInertia),l.isStatic||l.isSleeping||(y=r.sub(d,l.position,v),l.positionPrev.x-=m.x*l.inverseMass,l.positionPrev.y-=m.y*l.inverseMass,l.anglePrev-=r.cross(y,m)*l.inverseInertia))},i.solveVelocity=function(t,e){for(var n=e*e,o=r._temp[0],a=r._temp[1],l=r._temp[2],c=r._temp[3],u=r._temp[4],p=r._temp[5],d=0;d<t.length;d++){var f=t[d];if(f.isActive&&!f.isSensor){var h=f.collision,y=h.parentA,m=h.parentB,v=h.normal,g=h.tangent,x=f.activeContacts,b=1/x.length;y.velocity.x=y.position.x-y.positionPrev.x,y.velocity.y=y.position.y-y.positionPrev.y,m.velocity.x=m.position.x-m.positionPrev.x,m.velocity.y=m.position.y-m.positionPrev.y,y.angularVelocity=y.angle-y.anglePrev,m.angularVelocity=m.angle-m.anglePrev;for(var w=0;w<x.length;w++){var A=x[w],S=A.vertex,C=r.sub(S,y.position,a),_=r.sub(S,m.position,l),P=r.add(y.velocity,r.mult(r.perp(C),y.angularVelocity),c),M=r.add(m.velocity,r.mult(r.perp(_),m.angularVelocity),u),I=r.sub(P,M,p),T=r.dot(v,I),B=r.dot(g,I),k=Math.abs(B),O=s.sign(B),E=(1+f.restitution)*T,R=s.clamp(f.separation+T,0,1)*i._frictionNormalMultiplier,L=B,D=1/0;k>f.friction*f.frictionStatic*R*n&&(D=k,L=s.clamp(f.friction*O*n,-D,D));var V=r.cross(C,v),W=r.cross(_,v),F=b/(y.inverseMass+m.inverseMass+y.inverseInertia*V*V+m.inverseInertia*W*W);if(E*=F,L*=F,T<0&&T*T>i._restingThresh*n)A.normalImpulse=0;else{var z=A.normalImpulse;A.normalImpulse=Math.min(A.normalImpulse+E,0),E=A.normalImpulse-z}if(B*B>i._restingThreshTangent*n)A.tangentImpulse=0;else{var j=A.tangentImpulse;A.tangentImpulse=s.clamp(A.tangentImpulse+L,-D,D),L=A.tangentImpulse-j}o.x=v.x*E+g.x*L,o.y=v.y*E+g.y*L,y.isStatic||y.isSleeping||(y.positionPrev.x+=o.x*y.inverseMass,y.positionPrev.y+=o.y*y.inverseMass,y.anglePrev+=r.cross(C,o)*y.inverseInertia),m.isStatic||m.isSleeping||(m.positionPrev.x-=o.x*m.inverseMass,m.positionPrev.y-=o.y*m.inverseMass,m.anglePrev-=r.cross(_,o)*m.inverseInertia)}}}}},{"../core/Common":14,"../geometry/Bounds":26,"../geometry/Vector":28,"../geometry/Vertices":29}],11:[function(t,e,n){var i={};e.exports=i;var o=t("../geometry/Vertices"),r=t("../geometry/Vector");i.collides=function(t,e,n){var s,a,l,c,u=!1;if(n){var p=t.parent,d=e.parent,f=p.speed*p.speed+p.angularSpeed*p.angularSpeed+d.speed*d.speed+d.angularSpeed*d.angularSpeed;u=n&&n.collided&&f<.2,c=n}else c={collided:!1,bodyA:t,bodyB:e};if(n&&u){var h=c.axisBody,y=h===t?e:t,m=[h.axes[n.axisNumber]];if(l=i._overlapAxes(h.vertices,y.vertices,m),c.reused=!0,l.overlap<=0)return c.collided=!1,c}else{if((s=i._overlapAxes(t.vertices,e.vertices,t.axes)).overlap<=0)return c.collided=!1,c;if((a=i._overlapAxes(e.vertices,t.vertices,e.axes)).overlap<=0)return c.collided=!1,c;s.overlap<a.overlap?(l=s,c.axisBody=t):(l=a,c.axisBody=e),c.axisNumber=l.axisNumber}c.bodyA=t.id<e.id?t:e,c.bodyB=t.id<e.id?e:t,c.collided=!0,c.depth=l.overlap,c.parentA=c.bodyA.parent,c.parentB=c.bodyB.parent,t=c.bodyA,e=c.bodyB,r.dot(l.axis,r.sub(e.position,t.position))<0?c.normal={x:l.axis.x,y:l.axis.y}:c.normal={x:-l.axis.x,y:-l.axis.y},c.tangent=r.perp(c.normal),c.penetration=c.penetration||{},c.penetration.x=c.normal.x*c.depth,c.penetration.y=c.normal.y*c.depth;var v=i._findSupports(t,e,c.normal),g=[];if(o.contains(t.vertices,v[0])&&g.push(v[0]),o.contains(t.vertices,v[1])&&g.push(v[1]),g.length<2){var x=i._findSupports(e,t,r.neg(c.normal));o.contains(e.vertices,x[0])&&g.push(x[0]),g.length<2&&o.contains(e.vertices,x[1])&&g.push(x[1])}return g.length<1&&(g=[v[0]]),c.supports=g,c},i._overlapAxes=function(t,e,n){for(var o,s,a=r._temp[0],l=r._temp[1],c={overlap:Number.MAX_VALUE},u=0;u<n.length;u++){if(s=n[u],i._projectToAxis(a,t,s),i._projectToAxis(l,e,s),(o=Math.min(a.max-l.min,l.max-a.min))<=0)return c.overlap=o,c;o<c.overlap&&(c.overlap=o,c.axis=s,c.axisNumber=u)}return c},i._projectToAxis=function(t,e,n){for(var i=r.dot(e[0],n),o=i,s=1;s<e.length;s+=1){var a=r.dot(e[s],n);a>o?o=a:a<i&&(i=a)}t.min=i,t.max=o},i._findSupports=function(t,e,n){for(var i,o,s,a,l=Number.MAX_VALUE,c=r._temp[0],u=e.vertices,p=t.position,d=0;d<u.length;d++)o=u[d],c.x=o.x-p.x,c.y=o.y-p.y,(i=-r.dot(n,c))<l&&(l=i,s=o);var f=s.index-1>=0?s.index-1:u.length-1;o=u[f],c.x=o.x-p.x,c.y=o.y-p.y,l=-r.dot(n,c),a=o;var h=(s.index+1)%u.length;return o=u[h],c.x=o.x-p.x,c.y=o.y-p.y,(i=-r.dot(n,c))<l&&(a=o),[s,a]}},{"../geometry/Vector":28,"../geometry/Vertices":29}],12:[function(t,e,n){var i={};e.exports=i;var o=t("../geometry/Vertices"),r=t("../geometry/Vector"),s=t("../core/Sleeping"),a=t("../geometry/Bounds"),l=t("../geometry/Axes"),c=t("../core/Common");i._warming=.4,i._torqueDampen=1,i._minLength=1e-6,i.create=function(t){var e=t;e.bodyA&&!e.pointA&&(e.pointA={x:0,y:0}),e.bodyB&&!e.pointB&&(e.pointB={x:0,y:0});var n=e.bodyA?r.add(e.bodyA.position,e.pointA):e.pointA,i=e.bodyB?r.add(e.bodyB.position,e.pointB):e.pointB,o=r.magnitude(r.sub(n,i));e.length=void 0!==e.length?e.length:o,e.id=e.id||c.nextId(),e.label=e.label||"Constraint",e.type="constraint",e.stiffness=e.stiffness||(e.length>0?1:.7),e.damping=e.damping||0,e.angularStiffness=e.angularStiffness||0,e.angleA=e.bodyA?e.bodyA.angle:e.angleA,e.angleB=e.bodyB?e.bodyB.angle:e.angleB,e.plugin={};var s={visible:!0,lineWidth:2,strokeStyle:"#ffffff",type:"line",anchors:!0};return 0===e.length&&e.stiffness>.1?(s.type="pin",s.anchors=!1):e.stiffness<.9&&(s.type="spring"),e.render=c.extend(s,e.render),e},i.preSolveAll=function(t){for(var e=0;e<t.length;e+=1){var n=t[e],i=n.constraintImpulse;n.isStatic||0===i.x&&0===i.y&&0===i.angle||(n.position.x+=i.x,n.position.y+=i.y,n.angle+=i.angle)}},i.solveAll=function(t,e){for(var n=0;n<t.length;n+=1){var o=t[n],r=!o.bodyA||o.bodyA&&o.bodyA.isStatic,s=!o.bodyB||o.bodyB&&o.bodyB.isStatic;(r||s)&&i.solve(t[n],e)}for(n=0;n<t.length;n+=1)o=t[n],r=!o.bodyA||o.bodyA&&o.bodyA.isStatic,s=!o.bodyB||o.bodyB&&o.bodyB.isStatic,r||s||i.solve(t[n],e)},i.solve=function(t,e){var n=t.bodyA,o=t.bodyB,s=t.pointA,a=t.pointB;if(n||o){n&&!n.isStatic&&(r.rotate(s,n.angle-t.angleA,s),t.angleA=n.angle),o&&!o.isStatic&&(r.rotate(a,o.angle-t.angleB,a),t.angleB=o.angle);var l=s,c=a;if(n&&(l=r.add(n.position,s)),o&&(c=r.add(o.position,a)),l&&c){var u=r.sub(l,c),p=r.magnitude(u);p<i._minLength&&(p=i._minLength);var d,f,h,y,m,v=(p-t.length)/p,g=t.stiffness<1?t.stiffness*e:t.stiffness,x=r.mult(u,v*g),b=(n?n.inverseMass:0)+(o?o.inverseMass:0),w=(n?n.inverseInertia:0)+(o?o.inverseInertia:0),A=b+w;if(t.damping){var S=r.create();h=r.div(u,p),m=r.sub(o&&r.sub(o.position,o.positionPrev)||S,n&&r.sub(n.position,n.positionPrev)||S),y=r.dot(h,m)}n&&!n.isStatic&&(f=n.inverseMass/b,n.constraintImpulse.x-=x.x*f,n.constraintImpulse.y-=x.y*f,n.position.x-=x.x*f,n.position.y-=x.y*f,t.damping&&(n.positionPrev.x-=t.damping*h.x*y*f,n.positionPrev.y-=t.damping*h.y*y*f),d=r.cross(s,x)/A*i._torqueDampen*n.inverseInertia*(1-t.angularStiffness),n.constraintImpulse.angle-=d,n.angle-=d),o&&!o.isStatic&&(f=o.inverseMass/b,o.constraintImpulse.x+=x.x*f,o.constraintImpulse.y+=x.y*f,o.position.x+=x.x*f,o.position.y+=x.y*f,t.damping&&(o.positionPrev.x+=t.damping*h.x*y*f,o.positionPrev.y+=t.damping*h.y*y*f),d=r.cross(a,x)/A*i._torqueDampen*o.inverseInertia*(1-t.angularStiffness),o.constraintImpulse.angle+=d,o.angle+=d)}}},i.postSolveAll=function(t){for(var e=0;e<t.length;e++){var n=t[e],c=n.constraintImpulse;if(!(n.isStatic||0===c.x&&0===c.y&&0===c.angle)){s.set(n,!1);for(var u=0;u<n.parts.length;u++){var p=n.parts[u];o.translate(p.vertices,c),u>0&&(p.position.x+=c.x,p.position.y+=c.y),0!==c.angle&&(o.rotate(p.vertices,c.angle,n.position),l.rotate(p.axes,c.angle),u>0&&r.rotateAbout(p.position,c.angle,n.position,p.position)),a.update(p.bounds,p.vertices,n.velocity)}c.angle*=i._warming,c.x*=i._warming,c.y*=i._warming}}}},{"../core/Common":14,"../core/Sleeping":22,"../geometry/Axes":25,"../geometry/Bounds":26,"../geometry/Vector":28,"../geometry/Vertices":29}],13:[function(t,e,n){var i={};e.exports=i;var o=t("../geometry/Vertices"),r=t("../core/Sleeping"),s=t("../core/Mouse"),a=t("../core/Events"),l=t("../collision/Detector"),c=t("./Constraint"),u=t("../body/Composite"),p=t("../core/Common"),d=t("../geometry/Bounds");i.create=function(t,e){var n=(t?t.mouse:null)||(e?e.mouse:null);n||(t&&t.render&&t.render.canvas?n=s.create(t.render.canvas):e&&e.element?n=s.create(e.element):(n=s.create(),p.warn("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected")));var o=c.create({label:"Mouse Constraint",pointA:n.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),r={type:"mouseConstraint",mouse:n,element:null,body:null,constraint:o,collisionFilter:{category:1,mask:4294967295,group:0}},l=p.extend(r,e);return a.on(t,"beforeUpdate",function(){var e=u.allBodies(t.world);i.update(l,e),i._triggerEvents(l)}),l},i.update=function(t,e){var n=t.mouse,i=t.constraint,s=t.body;if(0===n.button){if(i.bodyB)r.set(i.bodyB,!1),i.pointA=n.position;else for(var c=0;c<e.length;c++)if(s=e[c],d.contains(s.bounds,n.position)&&l.canCollide(s.collisionFilter,t.collisionFilter))for(var u=s.parts.length>1?1:0;u<s.parts.length;u++){var p=s.parts[u];if(o.contains(p.vertices,n.position)){i.pointA=n.position,i.bodyB=t.body=s,i.pointB={x:n.position.x-s.position.x,y:n.position.y-s.position.y},i.angleB=s.angle,r.set(s,!1),a.trigger(t,"startdrag",{mouse:n,body:s});break}}}else i.bodyB=t.body=null,i.pointB=null,s&&a.trigger(t,"enddrag",{mouse:n,body:s})},i._triggerEvents=function(t){var e=t.mouse,n=e.sourceEvents;n.mousemove&&a.trigger(t,"mousemove",{mouse:e}),n.mousedown&&a.trigger(t,"mousedown",{mouse:e}),n.mouseup&&a.trigger(t,"mouseup",{mouse:e}),s.clearSourceEvents(e)}},{"../body/Composite":2,"../collision/Detector":5,"../core/Common":14,"../core/Events":16,"../core/Mouse":19,"../core/Sleeping":22,"../geometry/Bounds":26,"../geometry/Vertices":29,"./Constraint":12}],14:[function(t,n,i){(function(e){var i={};n.exports=i,function(){i._nextId=0,i._seed=0,i._nowStartTime=+new Date,i.extend=function(t,e){var n,o;"boolean"==typeof e?(n=2,o=e):(n=1,o=!0);for(var r=n;r<arguments.length;r++){var s=arguments[r];if(s)for(var a in s)o&&s[a]&&s[a].constructor===Object?t[a]&&t[a].constructor!==Object?t[a]=s[a]:(t[a]=t[a]||{},i.extend(t[a],o,s[a])):t[a]=s[a]}return t},i.clone=function(t,e){return i.extend({},e,t)},i.keys=function(t){if(Object.keys)return Object.keys(t);var e=[];for(var n in t)e.push(n);return e},i.values=function(t){var e=[];if(Object.keys){for(var n=Object.keys(t),i=0;i<n.length;i++)e.push(t[n[i]]);return e}for(var o in t)e.push(t[o]);return e},i.get=function(t,e,n,i){e=e.split(".").slice(n,i);for(var o=0;o<e.length;o+=1)t=t[e[o]];return t},i.set=function(t,e,n,o,r){var s=e.split(".").slice(o,r);return i.get(t,e,0,-1)[s[s.length-1]]=n,n},i.shuffle=function(t){for(var e=t.length-1;e>0;e--){var n=Math.floor(i.random()*(e+1)),o=t[e];t[e]=t[n],t[n]=o}return t},i.choose=function(t){return t[Math.floor(i.random()*t.length)]},i.isElement=function(t){return"undefined"!=typeof HTMLElement?t instanceof HTMLElement:!!(t&&t.nodeType&&t.nodeName)},i.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)},i.isFunction=function(t){return"function"==typeof t},i.isPlainObject=function(t){return"object"==typeof t&&t.constructor===Object},i.isString=function(t){return"[object String]"===toString.call(t)},i.clamp=function(t,e,n){return t<e?e:t>n?n:t},i.sign=function(t){return t<0?-1:1},i.now=function(){if(window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return new Date-i._nowStartTime},i.random=function(t,e){return e=void 0!==e?e:1,(t=void 0!==t?t:0)+n()*(e-t)};var n=function(){return i._seed=(9301*i._seed+49297)%233280,i._seed/233280};i.colorToNumber=function(t){return 3==(t=t.replace("#","")).length&&(t=t.charAt(0)+t.charAt(0)+t.charAt(1)+t.charAt(1)+t.charAt(2)+t.charAt(2)),parseInt(t,16)},i.logLevel=1,i.log=function(){console&&i.logLevel>0&&i.logLevel<=3&&console.log.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},i.info=function(){console&&i.logLevel>0&&i.logLevel<=2&&console.info.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},i.warn=function(){console&&i.logLevel>0&&i.logLevel<=3&&console.warn.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},i.nextId=function(){return i._nextId++},i.indexOf=function(t,e){if(t.indexOf)return t.indexOf(e);for(var n=0;n<t.length;n++)if(t[n]===e)return n;return-1},i.map=function(t,e){if(t.map)return t.map(e);for(var n=[],i=0;i<t.length;i+=1)n.push(e(t[i]));return n},i.topologicalSort=function(t){var e=[],n=[],o=[];for(var r in t)n[r]||o[r]||i._topologicalSort(r,n,o,t,e);return e},i._topologicalSort=function(t,e,n,o,r){var s=o[t]||[];n[t]=!0;for(var a=0;a<s.length;a+=1){var l=s[a];n[l]||e[l]||i._topologicalSort(l,e,n,o,r)}n[t]=!1,e[t]=!0,r.push(t)},i.chain=function(){for(var t=[],e=0;e<arguments.length;e+=1){var n=arguments[e];n._chained?t.push.apply(t,n._chained):t.push(n)}var i=function(){for(var e,n=new Array(arguments.length),i=0,o=arguments.length;i<o;i++)n[i]=arguments[i];for(i=0;i<t.length;i+=1){var r=t[i].apply(e,n);void 0!==r&&(e=r)}return e};return i._chained=t,i},i.chainPathBefore=function(t,e,n){return i.set(t,e,i.chain(n,i.get(t,e)))},i.chainPathAfter=function(t,e,n){return i.set(t,e,i.chain(i.get(t,e),n))},i._requireGlobal=function(n,i){var o="undefined"!=typeof window?window[n]:void 0!==e?e[n]:null;return o||t(i)}}()}).call(this,void 0!==e?e:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],15:[function(t,e,n){var i={};e.exports=i;var o=t("../body/World"),r=t("./Sleeping"),s=t("../collision/Resolver"),a=t("../render/Render"),l=t("../collision/Pairs"),c=(t("./Metrics"),t("../collision/Grid")),u=t("./Events"),p=t("../body/Composite"),d=t("../constraint/Constraint"),f=t("./Common"),h=t("../body/Body");i.create=function(t,e){e=f.isElement(t)?e:t,t=f.isElement(t)?t:null,e=e||{},(t||e.render)&&f.warn("Engine.create: engine.render is deprecated (see docs)");var n={positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],plugin:{},timing:{timestamp:0,timeScale:1},broadphase:{controller:c}},i=f.extend(n,e);if(t||i.render){var r={element:t,controller:a};i.render=f.extend(r,i.render)}return i.render&&i.render.controller&&(i.render=i.render.controller.create(i.render)),i.render&&(i.render.engine=i),i.world=e.world||o.create(i.world),i.pairs=l.create(),i.broadphase=i.broadphase.controller.create(i.broadphase),i.metrics=i.metrics||{extended:!1},i},i.update=function(t,e,n){e=e||1e3/60,n=n||1;var o,a=t.world,c=t.timing,f=t.broadphase,h=[];c.timestamp+=e*c.timeScale;var y={timestamp:c.timestamp};u.trigger(t,"beforeUpdate",y);var m=p.allBodies(a),v=p.allConstraints(a);for(t.enableSleeping&&r.update(m,c.timeScale),i._bodiesApplyGravity(m,a.gravity),i._bodiesUpdate(m,e,c.timeScale,n,a.bounds),d.preSolveAll(m),o=0;o<t.constraintIterations;o++)d.solveAll(v,c.timeScale);d.postSolveAll(m),f.controller?(a.isModified&&f.controller.clear(f),f.controller.update(f,m,t,a.isModified),h=f.pairsList):h=m,a.isModified&&p.setModified(a,!1,!1,!0);var g=f.detector(h,t),x=t.pairs,b=c.timestamp;for(l.update(x,g,b),l.removeOld(x,b),t.enableSleeping&&r.afterCollisions(x.list,c.timeScale),x.collisionStart.length>0&&u.trigger(t,"collisionStart",{pairs:x.collisionStart}),s.preSolvePosition(x.list),o=0;o<t.positionIterations;o++)s.solvePosition(x.list,c.timeScale);for(s.postSolvePosition(m),d.preSolveAll(m),o=0;o<t.constraintIterations;o++)d.solveAll(v,c.timeScale);for(d.postSolveAll(m),s.preSolveVelocity(x.list),o=0;o<t.velocityIterations;o++)s.solveVelocity(x.list,c.timeScale);return x.collisionActive.length>0&&u.trigger(t,"collisionActive",{pairs:x.collisionActive}),x.collisionEnd.length>0&&u.trigger(t,"collisionEnd",{pairs:x.collisionEnd}),i._bodiesClearForces(m),u.trigger(t,"afterUpdate",y),t},i.merge=function(t,e){if(f.extend(t,e),e.world){t.world=e.world,i.clear(t);for(var n=p.allBodies(t.world),o=0;o<n.length;o++){var s=n[o];r.set(s,!1),s.id=f.nextId()}}},i.clear=function(t){var e=t.world;l.clear(t.pairs);var n=t.broadphase;if(n.controller){var i=p.allBodies(e);n.controller.clear(n),n.controller.update(n,i,t,!0)}},i._bodiesClearForces=function(t){for(var e=0;e<t.length;e++){var n=t[e];n.force.x=0,n.force.y=0,n.torque=0}},i._bodiesApplyGravity=function(t,e){var n=void 0!==e.scale?e.scale:.001;if((0!==e.x||0!==e.y)&&0!==n)for(var i=0;i<t.length;i++){var o=t[i];o.isStatic||o.isSleeping||(o.force.y+=o.mass*e.y*n,o.force.x+=o.mass*e.x*n)}},i._bodiesUpdate=function(t,e,n,i,o){for(var r=0;r<t.length;r++){var s=t[r];s.isStatic||s.isSleeping||h.update(s,e,n,i)}}},{"../body/Body":1,"../body/Composite":2,"../body/World":3,"../collision/Grid":6,"../collision/Pairs":8,"../collision/Resolver":10,"../constraint/Constraint":12,"../render/Render":31,"./Common":14,"./Events":16,"./Metrics":18,"./Sleeping":22}],16:[function(t,e,n){var i={};e.exports=i;var o=t("./Common");i.on=function(t,e,n){for(var i,o=e.split(" "),r=0;r<o.length;r++)i=o[r],t.events=t.events||{},t.events[i]=t.events[i]||[],t.events[i].push(n);return n},i.off=function(t,e,n){if(e){"function"==typeof e&&(n=e,e=o.keys(t.events).join(" "));for(var i=e.split(" "),r=0;r<i.length;r++){var s=t.events[i[r]],a=[];if(n&&s)for(var l=0;l<s.length;l++)s[l]!==n&&a.push(s[l]);t.events[i[r]]=a}}else t.events={}},i.trigger=function(t,e,n){var i,r,s,a;if(t.events){n||(n={}),i=e.split(" ");for(var l=0;l<i.length;l++)if(r=i[l],s=t.events[r]){(a=o.clone(n,!1)).name=r,a.source=t;for(var c=0;c<s.length;c++)s[c].apply(t,[a])}}}},{"./Common":14}],17:[function(t,e,n){var i={};e.exports=i;var o=t("./Plugin"),r=t("./Common");i.name="matter-js",i.version="0.14.2",i.uses=[],i.used=[],i.use=function(){o.use(i,Array.prototype.slice.call(arguments))},i.before=function(t,e){return t=t.replace(/^Matter./,""),r.chainPathBefore(i,t,e)},i.after=function(t,e){return t=t.replace(/^Matter./,""),r.chainPathAfter(i,t,e)}},{"./Common":14,"./Plugin":20}],18:[function(t,e,n){},{"../body/Composite":2,"./Common":14}],19:[function(t,e,n){var i={};e.exports=i;var o=t("../core/Common");i.create=function(t){var e={};return t||o.log("Mouse.create: element was undefined, defaulting to document.body","warn"),e.element=t||document.body,e.absolute={x:0,y:0},e.position={x:0,y:0},e.mousedownPosition={x:0,y:0},e.mouseupPosition={x:0,y:0},e.offset={x:0,y:0},e.scale={x:1,y:1},e.wheelDelta=0,e.button=-1,e.pixelRatio=e.element.getAttribute("data-pixel-ratio")||1,e.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},e.mousemove=function(t){var n=i._getRelativeMousePosition(t,e.element,e.pixelRatio),o=t.changedTouches;o&&(e.button=0,t.preventDefault()),e.absolute.x=n.x,e.absolute.y=n.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y,e.sourceEvents.mousemove=t},e.mousedown=function(t){var n=i._getRelativeMousePosition(t,e.element,e.pixelRatio),o=t.changedTouches;o?(e.button=0,t.preventDefault()):e.button=t.button,e.absolute.x=n.x,e.absolute.y=n.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y,e.mousedownPosition.x=e.position.x,e.mousedownPosition.y=e.position.y,e.sourceEvents.mousedown=t},e.mouseup=function(t){var n=i._getRelativeMousePosition(t,e.element,e.pixelRatio),o=t.changedTouches;o&&t.preventDefault(),e.button=-1,e.absolute.x=n.x,e.absolute.y=n.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y,e.mouseupPosition.x=e.position.x,e.mouseupPosition.y=e.position.y,e.sourceEvents.mouseup=t},e.mousewheel=function(t){e.wheelDelta=Math.max(-1,Math.min(1,t.wheelDelta||-t.detail)),t.preventDefault()},i.setElement(e,e.element),e},i.setElement=function(t,e){t.element=e,e.addEventListener("mousemove",t.mousemove),e.addEventListener("mousedown",t.mousedown),e.addEventListener("mouseup",t.mouseup),e.addEventListener("mousewheel",t.mousewheel),e.addEventListener("DOMMouseScroll",t.mousewheel),e.addEventListener("touchmove",t.mousemove),e.addEventListener("touchstart",t.mousedown),e.addEventListener("touchend",t.mouseup)},i.clearSourceEvents=function(t){t.sourceEvents.mousemove=null,t.sourceEvents.mousedown=null,t.sourceEvents.mouseup=null,t.sourceEvents.mousewheel=null,t.wheelDelta=0},i.setOffset=function(t,e){t.offset.x=e.x,t.offset.y=e.y,t.position.x=t.absolute.x*t.scale.x+t.offset.x,t.position.y=t.absolute.y*t.scale.y+t.offset.y},i.setScale=function(t,e){t.scale.x=e.x,t.scale.y=e.y,t.position.x=t.absolute.x*t.scale.x+t.offset.x,t.position.y=t.absolute.y*t.scale.y+t.offset.y},i._getRelativeMousePosition=function(t,e,n){var i,o,r=e.getBoundingClientRect(),s=document.documentElement||document.body.parentNode||document.body,a=void 0!==window.pageXOffset?window.pageXOffset:s.scrollLeft,l=void 0!==window.pageYOffset?window.pageYOffset:s.scrollTop,c=t.changedTouches;return c?(i=c[0].pageX-r.left-a,o=c[0].pageY-r.top-l):(i=t.pageX-r.left-a,o=t.pageY-r.top-l),{x:i/(e.clientWidth/(e.width||e.clientWidth)*n),y:o/(e.clientHeight/(e.height||e.clientHeight)*n)}}},{"../core/Common":14}],20:[function(t,e,n){var i={};e.exports=i;var o=t("./Common");i._registry={},i.register=function(t){if(i.isPlugin(t)||o.warn("Plugin.register:",i.toString(t),"does not implement all required fields."),t.name in i._registry){var e=i._registry[t.name],n=i.versionParse(t.version).number,r=i.versionParse(e.version).number;n>r?(o.warn("Plugin.register:",i.toString(e),"was upgraded to",i.toString(t)),i._registry[t.name]=t):n<r?o.warn("Plugin.register:",i.toString(e),"can not be downgraded to",i.toString(t)):t!==e&&o.warn("Plugin.register:",i.toString(t),"is already registered to different plugin object")}else i._registry[t.name]=t;return t},i.resolve=function(t){return i._registry[i.dependencyParse(t).name]},i.toString=function(t){return"string"==typeof t?t:(t.name||"anonymous")+"@"+(t.version||t.range||"0.0.0")},i.isPlugin=function(t){return t&&t.name&&t.version&&t.install},i.isUsed=function(t,e){return t.used.indexOf(e)>-1},i.isFor=function(t,e){var n=t.for&&i.dependencyParse(t.for);return!t.for||e.name===n.name&&i.versionSatisfies(e.version,n.range)},i.use=function(t,e){if(t.uses=(t.uses||[]).concat(e||[]),0!==t.uses.length){for(var n=i.dependencies(t),r=o.topologicalSort(n),s=[],a=0;a<r.length;a+=1)if(r[a]!==t.name){var l=i.resolve(r[a]);l?i.isUsed(t,l.name)||(i.isFor(l,t)||(o.warn("Plugin.use:",i.toString(l),"is for",l.for,"but installed on",i.toString(t)+"."),l._warned=!0),l.install?l.install(t):(o.warn("Plugin.use:",i.toString(l),"does not specify an install function."),l._warned=!0),l._warned?(s.push(" "+i.toString(l)),delete l._warned):s.push(" "+i.toString(l)),t.used.push(l.name)):s.push(" "+r[a])}s.length>0&&o.info(s.join("  "))}else o.warn("Plugin.use:",i.toString(t),"does not specify any dependencies to install.")},i.dependencies=function(t,e){var n=i.dependencyParse(t),r=n.name;if(!(r in(e=e||{}))){t=i.resolve(t)||t,e[r]=o.map(t.uses||[],function(e){i.isPlugin(e)&&i.register(e);var r=i.dependencyParse(e),s=i.resolve(e);return s&&!i.versionSatisfies(s.version,r.range)?(o.warn("Plugin.dependencies:",i.toString(s),"does not satisfy",i.toString(r),"used by",i.toString(n)+"."),s._warned=!0,t._warned=!0):s||(o.warn("Plugin.dependencies:",i.toString(e),"used by",i.toString(n),"could not be resolved."),t._warned=!0),r.name});for(var s=0;s<e[r].length;s+=1)i.dependencies(e[r][s],e);return e}},i.dependencyParse=function(t){return o.isString(t)?(/^[\w-]+(@(\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-]+)?))?$/.test(t)||o.warn("Plugin.dependencyParse:",t,"is not a valid dependency string."),{name:t.split("@")[0],range:t.split("@")[1]||"*"}):{name:t.name,range:t.range||t.version}},i.versionParse=function(t){/^\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-]+)?$/.test(t)||o.warn("Plugin.versionParse:",t,"is not a valid version or range.");var e=t.split("-");t=e[0];var n=isNaN(Number(t[0])),i=n?t.substr(1):t,r=o.map(i.split("."),function(t){return Number(t)});return{isRange:n,version:i,range:t,operator:n?t[0]:"",parts:r,prerelease:e[1],number:1e8*r[0]+1e4*r[1]+r[2]}},i.versionSatisfies=function(t,e){e=e||"*";var n=i.versionParse(e),o=n.parts,r=i.versionParse(t),s=r.parts;if(n.isRange){if("*"===n.operator||"*"===t)return!0;if("~"===n.operator)return s[0]===o[0]&&s[1]===o[1]&&s[2]>=o[2];if("^"===n.operator)return o[0]>0?s[0]===o[0]&&r.number>=n.number:o[1]>0?s[1]===o[1]&&s[2]>=o[2]:s[2]===o[2]}return t===e||"*"===t}},{"./Common":14}],21:[function(t,e,n){var i={};e.exports=i;var o,r,s,a=t("./Events"),l=t("./Engine"),c=t("./Common");"undefined"!=typeof window&&(o=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame,r=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),o||(o=function(t){s=setTimeout(function(){t(c.now())},1e3/60)},r=function(){clearTimeout(s)}),i.create=function(t){var e=c.extend({fps:60,correction:1,deltaSampleSize:60,counterTimestamp:0,frameCounter:0,deltaHistory:[],timePrev:null,timeScalePrev:1,frameRequestId:null,isFixed:!1,enabled:!0},t);return e.delta=e.delta||1e3/e.fps,e.deltaMin=e.deltaMin||1e3/e.fps,e.deltaMax=e.deltaMax||1e3/(.5*e.fps),e.fps=1e3/e.delta,e},i.run=function(t,e){return void 0!==t.positionIterations&&(e=t,t=i.create()),function n(r){t.frameRequestId=o(n),r&&t.enabled&&i.tick(t,e,r)}(),t},i.tick=function(t,e,n){var i,o=e.timing,r=1,s={timestamp:o.timestamp};a.trigger(t,"beforeTick",s),a.trigger(e,"beforeTick",s),t.isFixed?i=t.delta:(i=n-t.timePrev||t.delta,t.timePrev=n,t.deltaHistory.push(i),t.deltaHistory=t.deltaHistory.slice(-t.deltaSampleSize),i=(i=(i=Math.min.apply(null,t.deltaHistory))<t.deltaMin?t.deltaMin:i)>t.deltaMax?t.deltaMax:i,r=i/t.delta,t.delta=i),0!==t.timeScalePrev&&(r*=o.timeScale/t.timeScalePrev),0===o.timeScale&&(r=0),t.timeScalePrev=o.timeScale,t.correction=r,t.frameCounter+=1,n-t.counterTimestamp>=1e3&&(t.fps=t.frameCounter*((n-t.counterTimestamp)/1e3),t.counterTimestamp=n,t.frameCounter=0),a.trigger(t,"tick",s),a.trigger(e,"tick",s),e.world.isModified&&e.render&&e.render.controller&&e.render.controller.clear&&e.render.controller.clear(e.render),a.trigger(t,"beforeUpdate",s),l.update(e,i,r),a.trigger(t,"afterUpdate",s),e.render&&e.render.controller&&(a.trigger(t,"beforeRender",s),a.trigger(e,"beforeRender",s),e.render.controller.world(e.render),a.trigger(t,"afterRender",s),a.trigger(e,"afterRender",s)),a.trigger(t,"afterTick",s),a.trigger(e,"afterTick",s)},i.stop=function(t){r(t.frameRequestId)},i.start=function(t,e){i.run(t,e)}},{"./Common":14,"./Engine":15,"./Events":16}],22:[function(t,e,n){var i={};e.exports=i;var o=t("./Events");i._motionWakeThreshold=.18,i._motionSleepThreshold=.08,i._minBias=.9,i.update=function(t,e){for(var n=e*e*e,o=0;o<t.length;o++){var r=t[o],s=r.speed*r.speed+r.angularSpeed*r.angularSpeed;if(0===r.force.x&&0===r.force.y){var a=Math.min(r.motion,s),l=Math.max(r.motion,s);r.motion=i._minBias*a+(1-i._minBias)*l,r.sleepThreshold>0&&r.motion<i._motionSleepThreshold*n?(r.sleepCounter+=1,r.sleepCounter>=r.sleepThreshold&&i.set(r,!0)):r.sleepCounter>0&&(r.sleepCounter-=1)}else i.set(r,!1)}},i.afterCollisions=function(t,e){for(var n=e*e*e,o=0;o<t.length;o++){var r=t[o];if(r.isActive){var s=r.collision,a=s.bodyA.parent,l=s.bodyB.parent;if(!(a.isSleeping&&l.isSleeping||a.isStatic||l.isStatic)&&(a.isSleeping||l.isSleeping)){var c=a.isSleeping&&!a.isStatic?a:l,u=c===a?l:a;!c.isStatic&&u.motion>i._motionWakeThreshold*n&&i.set(c,!1)}}}},i.set=function(t,e){var n=t.isSleeping;e?(t.isSleeping=!0,t.sleepCounter=t.sleepThreshold,t.positionImpulse.x=0,t.positionImpulse.y=0,t.positionPrev.x=t.position.x,t.positionPrev.y=t.position.y,t.anglePrev=t.angle,t.speed=0,t.angularSpeed=0,t.motion=0,n||o.trigger(t,"sleepStart")):(t.isSleeping=!1,t.sleepCounter=0,n&&o.trigger(t,"sleepEnd"))}},{"./Events":16}],23:[function(t,e,n){var i={};e.exports=i;var o,r=t("../geometry/Vertices"),s=t("../core/Common"),a=t("../body/Body"),l=t("../geometry/Bounds"),c=t("../geometry/Vector");i.rectangle=function(t,e,n,i,o){o=o||{};var l={label:"Rectangle Body",position:{x:t,y:e},vertices:r.fromPath("L 0 0 L "+n+" 0 L "+n+" "+i+" L 0 "+i)};if(o.chamfer){var c=o.chamfer;l.vertices=r.chamfer(l.vertices,c.radius,c.quality,c.qualityMin,c.qualityMax),delete o.chamfer}return a.create(s.extend({},l,o))},i.trapezoid=function(t,e,n,i,o,l){l=l||{};var c,u=(1-2*(o*=.5))*n,p=n*o,d=p+u,f=d+p;c=o<.5?"L 0 0 L "+p+" "+-i+" L "+d+" "+-i+" L "+f+" 0":"L 0 0 L "+d+" "+-i+" L "+f+" 0";var h={label:"Trapezoid Body",position:{x:t,y:e},vertices:r.fromPath(c)};if(l.chamfer){var y=l.chamfer;h.vertices=r.chamfer(h.vertices,y.radius,y.quality,y.qualityMin,y.qualityMax),delete l.chamfer}return a.create(s.extend({},h,l))},i.circle=function(t,e,n,o,r){o=o||{};var a={label:"Circle Body",circleRadius:n};r=r||25;var l=Math.ceil(Math.max(10,Math.min(r,n)));return l%2==1&&(l+=1),i.polygon(t,e,l,n,s.extend({},a,o))},i.polygon=function(t,e,n,o,l){if(l=l||{},n<3)return i.circle(t,e,o,l);for(var c=2*Math.PI/n,u="",p=.5*c,d=0;d<n;d+=1){var f=p+d*c,h=Math.cos(f)*o,y=Math.sin(f)*o;u+="L "+h.toFixed(3)+" "+y.toFixed(3)+" "}var m={label:"Polygon Body",position:{x:t,y:e},vertices:r.fromPath(u)};if(l.chamfer){var v=l.chamfer;m.vertices=r.chamfer(m.vertices,v.radius,v.quality,v.qualityMin,v.qualityMax),delete l.chamfer}return a.create(s.extend({},m,l))},i.fromVertices=function(t,e,n,i,u,p,d){var f,h,y,m,v,g,x,b,w;for(o||(o=s._requireGlobal("decomp","poly-decomp")),i=i||{},h=[],u=void 0!==u&&u,p=void 0!==p?p:.01,d=void 0!==d?d:10,o||s.warn("Bodies.fromVertices: poly-decomp.js required. Could not decompose vertices. Fallback to convex hull."),s.isArray(n[0])||(n=[n]),b=0;b<n.length;b+=1)if(m=n[b],(y=r.isConvex(m))||!o)m=y?r.clockwiseSort(m):r.hull(m),h.push({position:{x:t,y:e},vertices:m});else{var A=m.map(function(t){return[t.x,t.y]});o.makeCCW(A),!1!==p&&o.removeCollinearPoints(A,p);var S=o.quickDecomp(A);for(v=0;v<S.length;v++){var C=S[v],_=C.map(function(t){return{x:t[0],y:t[1]}});d>0&&r.area(_)<d||h.push({position:r.centre(_),vertices:_})}}for(v=0;v<h.length;v++)h[v]=a.create(s.extend(h[v],i));if(u)for(v=0;v<h.length;v++){var P=h[v];for(g=v+1;g<h.length;g++){var M=h[g];if(l.overlaps(P.bounds,M.bounds)){var I=P.vertices,T=M.vertices;for(x=0;x<P.vertices.length;x++)for(w=0;w<M.vertices.length;w++){var B=c.magnitudeSquared(c.sub(I[(x+1)%I.length],T[w])),k=c.magnitudeSquared(c.sub(I[x],T[(w+1)%T.length]));B<5&&k<5&&(I[x].isInternal=!0,T[w].isInternal=!0)}}}}return h.length>1?(f=a.create(s.extend({parts:h.slice(0)},i)),a.setPosition(f,{x:t,y:e}),f):h[0]}},{"../body/Body":1,"../core/Common":14,"../geometry/Bounds":26,"../geometry/Vector":28,"../geometry/Vertices":29}],24:[function(t,e,n){var i={};e.exports=i;var o=t("../body/Composite"),r=t("../constraint/Constraint"),s=t("../core/Common"),a=t("../body/Body"),l=t("./Bodies");i.stack=function(t,e,n,i,r,s,l){for(var c,u=o.create({label:"Stack"}),p=t,d=e,f=0,h=0;h<i;h++){for(var y=0,m=0;m<n;m++){var v=l(p,d,m,h,c,f);if(v){var g=v.bounds.max.y-v.bounds.min.y,x=v.bounds.max.x-v.bounds.min.x;g>y&&(y=g),a.translate(v,{x:.5*x,y:.5*g}),p=v.bounds.max.x+r,o.addBody(u,v),c=v,f+=1}else p+=r}d+=y+s,p=t}return u},i.chain=function(t,e,n,i,a,l){for(var c=t.bodies,u=1;u<c.length;u++){var p=c[u-1],d=c[u],f=p.bounds.max.y-p.bounds.min.y,h=p.bounds.max.x-p.bounds.min.x,y=d.bounds.max.y-d.bounds.min.y,m=d.bounds.max.x-d.bounds.min.x,v={bodyA:p,pointA:{x:h*e,y:f*n},bodyB:d,pointB:{x:m*i,y:y*a}},g=s.extend(v,l);o.addConstraint(t,r.create(g))}return t.label+=" Chain",t},i.mesh=function(t,e,n,i,a){var l,c,u,p,d,f=t.bodies;for(l=0;l<n;l++){for(c=1;c<e;c++)u=f[c-1+l*e],p=f[c+l*e],o.addConstraint(t,r.create(s.extend({bodyA:u,bodyB:p},a)));if(l>0)for(c=0;c<e;c++)u=f[c+(l-1)*e],p=f[c+l*e],o.addConstraint(t,r.create(s.extend({bodyA:u,bodyB:p},a))),i&&c>0&&(d=f[c-1+(l-1)*e],o.addConstraint(t,r.create(s.extend({bodyA:d,bodyB:p},a)))),i&&c<e-1&&(d=f[c+1+(l-1)*e],o.addConstraint(t,r.create(s.extend({bodyA:d,bodyB:p},a))))}return t.label+=" Mesh",t},i.pyramid=function(t,e,n,o,r,s,l){return i.stack(t,e,n,o,r,s,function(e,i,s,c,u,p){var d=Math.min(o,Math.ceil(n/2)),f=u?u.bounds.max.x-u.bounds.min.x:0;if(!(c>d)){var h=c=d-c,y=n-1-c;if(!(s<h||s>y)){1===p&&a.translate(u,{x:(s+(n%2==1?1:-1))*f,y:0});var m=u?s*f:0;return l(t+m+s*r,i,s,c,u,p)}}})},i.newtonsCradle=function(t,e,n,i,s){for(var a=o.create({label:"Newtons Cradle"}),c=0;c<n;c++){var u=l.circle(t+c*(1.9*i),e+s,i,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),p=r.create({pointA:{x:t+c*(1.9*i),y:e},bodyB:u});o.addBody(a,u),o.addConstraint(a,p)}return a},i.car=function(t,e,n,i,s){var c=a.nextGroup(!0),u=.5*-n+20,p=.5*n-20,d=o.create({label:"Car"}),f=l.rectangle(t,e,n,i,{collisionFilter:{group:c},chamfer:{radius:.5*i},density:2e-4}),h=l.circle(t+u,e+0,s,{collisionFilter:{group:c},friction:.8}),y=l.circle(t+p,e+0,s,{collisionFilter:{group:c},friction:.8}),m=r.create({bodyB:f,pointB:{x:u,y:0},bodyA:h,stiffness:1,length:0}),v=r.create({bodyB:f,pointB:{x:p,y:0},bodyA:y,stiffness:1,length:0});return o.addBody(d,f),o.addBody(d,h),o.addBody(d,y),o.addConstraint(d,m),o.addConstraint(d,v),d},i.softBody=function(t,e,n,o,r,a,c,u,p,d){p=s.extend({inertia:1/0},p),d=s.extend({stiffness:.2,render:{type:"line",anchors:!1}},d);var f=i.stack(t,e,n,o,r,a,function(t,e){return l.circle(t,e,u,p)});return i.mesh(f,n,o,c,d),f.label="Soft Body",f}},{"../body/Body":1,"../body/Composite":2,"../constraint/Constraint":12,"../core/Common":14,"./Bodies":23}],25:[function(t,e,n){var i={};e.exports=i;var o=t("../geometry/Vector"),r=t("../core/Common");i.fromVertices=function(t){for(var e={},n=0;n<t.length;n++){var i=(n+1)%t.length,s=o.normalise({x:t[i].y-t[n].y,y:t[n].x-t[i].x}),a=0===s.y?1/0:s.x/s.y;a=a.toFixed(3).toString(),e[a]=s}return r.values(e)},i.rotate=function(t,e){if(0!==e)for(var n=Math.cos(e),i=Math.sin(e),o=0;o<t.length;o++){var r,s=t[o];r=s.x*n-s.y*i,s.y=s.x*i+s.y*n,s.x=r}}},{"../core/Common":14,"../geometry/Vector":28}],26:[function(t,e,n){var i={};e.exports=i,i.create=function(t){var e={min:{x:0,y:0},max:{x:0,y:0}};return t&&i.update(e,t),e},i.update=function(t,e,n){t.min.x=1/0,t.max.x=-1/0,t.min.y=1/0,t.max.y=-1/0;for(var i=0;i<e.length;i++){var o=e[i];o.x>t.max.x&&(t.max.x=o.x),o.x<t.min.x&&(t.min.x=o.x),o.y>t.max.y&&(t.max.y=o.y),o.y<t.min.y&&(t.min.y=o.y)}n&&(n.x>0?t.max.x+=n.x:t.min.x+=n.x,n.y>0?t.max.y+=n.y:t.min.y+=n.y)},i.contains=function(t,e){return e.x>=t.min.x&&e.x<=t.max.x&&e.y>=t.min.y&&e.y<=t.max.y},i.overlaps=function(t,e){return t.min.x<=e.max.x&&t.max.x>=e.min.x&&t.max.y>=e.min.y&&t.min.y<=e.max.y},i.translate=function(t,e){t.min.x+=e.x,t.max.x+=e.x,t.min.y+=e.y,t.max.y+=e.y},i.shift=function(t,e){var n=t.max.x-t.min.x,i=t.max.y-t.min.y;t.min.x=e.x,t.max.x=e.x+n,t.min.y=e.y,t.max.y=e.y+i}},{}],27:[function(t,e,n){var i={};e.exports=i,t("../geometry/Bounds");var o=t("../core/Common");i.pathToVertices=function(t,e){"undefined"==typeof window||"SVGPathSeg"in window||o.warn("Svg.pathToVertices: SVGPathSeg not defined, a polyfill is required.");var n,r,s,a,l,c,u,p,d,f,h,y,m=[],v=0,g=0,x=0;e=e||15;var b=function(t,e,n){var i=n%2==1&&n>1;if(!d||t!=d.x||e!=d.y){d&&i?(h=d.x,y=d.y):(h=0,y=0);var o={x:h+t,y:y+e};!i&&d||(d=o),m.push(o),g=h+t,x=y+e}},w=function(t){var e=t.pathSegTypeAsLetter.toUpperCase();if("Z"!==e){switch(e){case"M":case"L":case"T":case"C":case"S":case"Q":g=t.x,x=t.y;break;case"H":g=t.x;break;case"V":x=t.y}b(g,x,t.pathSegType)}};for(i._svgPathToAbsolute(t),s=t.getTotalLength(),c=[],n=0;n<t.pathSegList.numberOfItems;n+=1)c.push(t.pathSegList.getItem(n));for(u=c.concat();v<s;){if(f=t.getPathSegAtLength(v),(l=c[f])!=p){for(;u.length&&u[0]!=l;)w(u.shift());p=l}switch(l.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":a=t.getPointAtLength(v),b(a.x,a.y,0)}v+=e}for(n=0,r=u.length;n<r;++n)w(u[n]);return m},i._svgPathToAbsolute=function(t){for(var e,n,i,o,r,s,a=t.pathSegList,l=0,c=0,u=a.numberOfItems,p=0;p<u;++p){var d=a.getItem(p),f=d.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(f))"x"in d&&(l=d.x),"y"in d&&(c=d.y);else switch("x1"in d&&(i=l+d.x1),"x2"in d&&(r=l+d.x2),"y1"in d&&(o=c+d.y1),"y2"in d&&(s=c+d.y2),"x"in d&&(l+=d.x),"y"in d&&(c+=d.y),f){case"m":a.replaceItem(t.createSVGPathSegMovetoAbs(l,c),p);break;case"l":a.replaceItem(t.createSVGPathSegLinetoAbs(l,c),p);break;case"h":a.replaceItem(t.createSVGPathSegLinetoHorizontalAbs(l),p);break;case"v":a.replaceItem(t.createSVGPathSegLinetoVerticalAbs(c),p);break;case"c":a.replaceItem(t.createSVGPathSegCurvetoCubicAbs(l,c,i,o,r,s),p);break;case"s":a.replaceItem(t.createSVGPathSegCurvetoCubicSmoothAbs(l,c,r,s),p);break;case"q":a.replaceItem(t.createSVGPathSegCurvetoQuadraticAbs(l,c,i,o),p);break;case"t":a.replaceItem(t.createSVGPathSegCurvetoQuadraticSmoothAbs(l,c),p);break;case"a":a.replaceItem(t.createSVGPathSegArcAbs(l,c,d.r1,d.r2,d.angle,d.largeArcFlag,d.sweepFlag),p);break;case"z":case"Z":l=e,c=n}"M"!=f&&"m"!=f||(e=l,n=c)}}},{"../core/Common":14,"../geometry/Bounds":26}],28:[function(t,e,n){var i={};e.exports=i,i.create=function(t,e){return{x:t||0,y:e||0}},i.clone=function(t){return{x:t.x,y:t.y}},i.magnitude=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},i.magnitudeSquared=function(t){return t.x*t.x+t.y*t.y},i.rotate=function(t,e,n){var i=Math.cos(e),o=Math.sin(e);n||(n={});var r=t.x*i-t.y*o;return n.y=t.x*o+t.y*i,n.x=r,n},i.rotateAbout=function(t,e,n,i){var o=Math.cos(e),r=Math.sin(e);i||(i={});var s=n.x+((t.x-n.x)*o-(t.y-n.y)*r);return i.y=n.y+((t.x-n.x)*r+(t.y-n.y)*o),i.x=s,i},i.normalise=function(t){var e=i.magnitude(t);return 0===e?{x:0,y:0}:{x:t.x/e,y:t.y/e}},i.dot=function(t,e){return t.x*e.x+t.y*e.y},i.cross=function(t,e){return t.x*e.y-t.y*e.x},i.cross3=function(t,e,n){return(e.x-t.x)*(n.y-t.y)-(e.y-t.y)*(n.x-t.x)},i.add=function(t,e,n){return n||(n={}),n.x=t.x+e.x,n.y=t.y+e.y,n},i.sub=function(t,e,n){return n||(n={}),n.x=t.x-e.x,n.y=t.y-e.y,n},i.mult=function(t,e){return{x:t.x*e,y:t.y*e}},i.div=function(t,e){return{x:t.x/e,y:t.y/e}},i.perp=function(t,e){return{x:(e=!0===e?-1:1)*-t.y,y:e*t.x}},i.neg=function(t){return{x:-t.x,y:-t.y}},i.angle=function(t,e){return Math.atan2(e.y-t.y,e.x-t.x)},i._temp=[i.create(),i.create(),i.create(),i.create(),i.create(),i.create()]},{}],29:[function(t,e,n){var i={};e.exports=i;var o=t("../geometry/Vector"),r=t("../core/Common");i.create=function(t,e){for(var n=[],i=0;i<t.length;i++){var o=t[i],r={x:o.x,y:o.y,index:i,body:e,isInternal:!1};n.push(r)}return n},i.fromPath=function(t,e){var n=[];return t.replace(/L?\s*([\-\d\.e]+)[\s,]*([\-\d\.e]+)*/gi,function(t,e,i){n.push({x:parseFloat(e),y:parseFloat(i)})}),i.create(n,e)},i.centre=function(t){for(var e,n,r,s=i.area(t,!0),a={x:0,y:0},l=0;l<t.length;l++)r=(l+1)%t.length,e=o.cross(t[l],t[r]),n=o.mult(o.add(t[l],t[r]),e),a=o.add(a,n);return o.div(a,6*s)},i.mean=function(t){for(var e={x:0,y:0},n=0;n<t.length;n++)e.x+=t[n].x,e.y+=t[n].y;return o.div(e,t.length)},i.area=function(t,e){for(var n=0,i=t.length-1,o=0;o<t.length;o++)n+=(t[i].x-t[o].x)*(t[i].y+t[o].y),i=o;return e?n/2:Math.abs(n)/2},i.inertia=function(t,e){for(var n,i,r=0,s=0,a=t,l=0;l<a.length;l++)i=(l+1)%a.length,n=Math.abs(o.cross(a[i],a[l])),r+=n*(o.dot(a[i],a[i])+o.dot(a[i],a[l])+o.dot(a[l],a[l])),s+=n;return e/6*(r/s)},i.translate=function(t,e,n){var i;if(n)for(i=0;i<t.length;i++)t[i].x+=e.x*n,t[i].y+=e.y*n;else for(i=0;i<t.length;i++)t[i].x+=e.x,t[i].y+=e.y;return t},i.rotate=function(t,e,n){if(0!==e){for(var i=Math.cos(e),o=Math.sin(e),r=0;r<t.length;r++){var s=t[r],a=s.x-n.x,l=s.y-n.y;s.x=n.x+(a*i-l*o),s.y=n.y+(a*o+l*i)}return t}},i.contains=function(t,e){for(var n=0;n<t.length;n++){var i=t[n],o=t[(n+1)%t.length];if((e.x-i.x)*(o.y-i.y)+(e.y-i.y)*(i.x-o.x)>0)return!1}return!0},i.scale=function(t,e,n,r){if(1===e&&1===n)return t;var s,a;r=r||i.centre(t);for(var l=0;l<t.length;l++)s=t[l],a=o.sub(s,r),t[l].x=r.x+a.x*e,t[l].y=r.y+a.y*n;return t},i.chamfer=function(t,e,n,i,s){e="number"==typeof e?[e]:e||[8],n=void 0!==n?n:-1,i=i||2,s=s||14;for(var a=[],l=0;l<t.length;l++){var c=t[l-1>=0?l-1:t.length-1],u=t[l],p=t[(l+1)%t.length],d=e[l<e.length?l:e.length-1];if(0!==d){var f=o.normalise({x:u.y-c.y,y:c.x-u.x}),h=o.normalise({x:p.y-u.y,y:u.x-p.x}),y=Math.sqrt(2*Math.pow(d,2)),m=o.mult(r.clone(f),d),v=o.normalise(o.mult(o.add(f,h),.5)),g=o.sub(u,o.mult(v,y)),x=n;-1===n&&(x=1.75*Math.pow(d,.32)),(x=r.clamp(x,i,s))%2==1&&(x+=1);for(var b=Math.acos(o.dot(f,h)),w=b/x,A=0;A<x;A++)a.push(o.add(o.rotate(m,w*A),g))}else a.push(u)}return a},i.clockwiseSort=function(t){var e=i.mean(t);return t.sort(function(t,n){return o.angle(e,t)-o.angle(e,n)}),t},i.isConvex=function(t){var e,n,i,o,r=0,s=t.length;if(s<3)return null;for(e=0;e<s;e++)if(i=(e+2)%s,o=(t[n=(e+1)%s].x-t[e].x)*(t[i].y-t[n].y),(o-=(t[n].y-t[e].y)*(t[i].x-t[n].x))<0?r|=1:o>0&&(r|=2),3===r)return!1;return 0!==r||null},i.hull=function(t){var e,n,i=[],r=[];for((t=t.slice(0)).sort(function(t,e){var n=t.x-e.x;return 0!==n?n:t.y-e.y}),n=0;n<t.length;n+=1){for(e=t[n];r.length>=2&&o.cross3(r[r.length-2],r[r.length-1],e)<=0;)r.pop();r.push(e)}for(n=t.length-1;n>=0;n-=1){for(e=t[n];i.length>=2&&o.cross3(i[i.length-2],i[i.length-1],e)<=0;)i.pop();i.push(e)}return i.pop(),r.pop(),i.concat(r)}},{"../core/Common":14,"../geometry/Vector":28}],30:[function(t,e,n){var i=e.exports=t("../core/Matter");i.Body=t("../body/Body"),i.Composite=t("../body/Composite"),i.World=t("../body/World"),i.Contact=t("../collision/Contact"),i.Detector=t("../collision/Detector"),i.Grid=t("../collision/Grid"),i.Pairs=t("../collision/Pairs"),i.Pair=t("../collision/Pair"),i.Query=t("../collision/Query"),i.Resolver=t("../collision/Resolver"),i.SAT=t("../collision/SAT"),i.Constraint=t("../constraint/Constraint"),i.MouseConstraint=t("../constraint/MouseConstraint"),i.Common=t("../core/Common"),i.Engine=t("../core/Engine"),i.Events=t("../core/Events"),i.Mouse=t("../core/Mouse"),i.Runner=t("../core/Runner"),i.Sleeping=t("../core/Sleeping"),i.Plugin=t("../core/Plugin"),i.Bodies=t("../factory/Bodies"),i.Composites=t("../factory/Composites"),i.Axes=t("../geometry/Axes"),i.Bounds=t("../geometry/Bounds"),i.Svg=t("../geometry/Svg"),i.Vector=t("../geometry/Vector"),i.Vertices=t("../geometry/Vertices"),i.Render=t("../render/Render"),i.RenderPixi=t("../render/RenderPixi"),i.World.add=i.Composite.add,i.World.remove=i.Composite.remove,i.World.addComposite=i.Composite.addComposite,i.World.addBody=i.Composite.addBody,i.World.addConstraint=i.Composite.addConstraint,i.World.clear=i.Composite.clear,i.Engine.run=i.Runner.run},{"../body/Body":1,"../body/Composite":2,"../body/World":3,"../collision/Contact":4,"../collision/Detector":5,"../collision/Grid":6,"../collision/Pair":7,"../collision/Pairs":8,"../collision/Query":9,"../collision/Resolver":10,"../collision/SAT":11,"../constraint/Constraint":12,"../constraint/MouseConstraint":13,"../core/Common":14,"../core/Engine":15,"../core/Events":16,"../core/Matter":17,"../core/Metrics":18,"../core/Mouse":19,"../core/Plugin":20,"../core/Runner":21,"../core/Sleeping":22,"../factory/Bodies":23,"../factory/Composites":24,"../geometry/Axes":25,"../geometry/Bounds":26,"../geometry/Svg":27,"../geometry/Vector":28,"../geometry/Vertices":29,"../render/Render":31,"../render/RenderPixi":32}],31:[function(t,e,n){var i={};e.exports=i;var o=t("../core/Common"),r=t("../body/Composite"),s=t("../geometry/Bounds"),a=t("../core/Events"),l=t("../collision/Grid"),c=t("../geometry/Vector"),u=t("../core/Mouse");!function(){var t,e;"undefined"!=typeof window&&(t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(function(){t(o.now())},1e3/60)},e=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),i.create=function(t){var e={controller:i,engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,options:{width:800,height:600,pixelRatio:1,background:"#18181d",wireframeBackground:"#0f0f13",hasBounds:!!t.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},r=o.extend(e,t);return r.canvas&&(r.canvas.width=r.options.width||r.canvas.width,r.canvas.height=r.options.height||r.canvas.height),r.mouse=t.mouse,r.engine=t.engine,r.canvas=r.canvas||n(r.options.width,r.options.height),r.context=r.canvas.getContext("2d"),r.textures={},r.bounds=r.bounds||{min:{x:0,y:0},max:{x:r.canvas.width,y:r.canvas.height}},1!==r.options.pixelRatio&&i.setPixelRatio(r,r.options.pixelRatio),o.isElement(r.element)?r.element.appendChild(r.canvas):r.canvas.parentNode||o.log("Render.create: options.element was undefined, render.canvas was created but not appended","warn"),r},i.run=function(e){!function n(o){e.frameRequestId=t(n),i.world(e)}()},i.stop=function(t){e(t.frameRequestId)},i.setPixelRatio=function(t,e){var n=t.options,i=t.canvas;"auto"===e&&(e=p(i)),n.pixelRatio=e,i.setAttribute("data-pixel-ratio",e),i.width=n.width*e,i.height=n.height*e,i.style.width=n.width+"px",i.style.height=n.height+"px",t.context.scale(e,e)},i.lookAt=function(t,e,n,i){i=void 0===i||i,e=o.isArray(e)?e:[e],n=n||{x:0,y:0};for(var r={min:{x:1/0,y:1/0},max:{x:-1/0,y:-1/0}},s=0;s<e.length;s+=1){var a=e[s],l=a.bounds?a.bounds.min:a.min||a.position||a,c=a.bounds?a.bounds.max:a.max||a.position||a;l&&c&&(l.x<r.min.x&&(r.min.x=l.x),c.x>r.max.x&&(r.max.x=c.x),l.y<r.min.y&&(r.min.y=l.y),c.y>r.max.y&&(r.max.y=c.y))}var p=r.max.x-r.min.x+2*n.x,d=r.max.y-r.min.y+2*n.y,f=t.canvas.height,h=t.canvas.width,y=h/f,m=p/d,v=1,g=1;m>y?g=m/y:v=y/m,t.options.hasBounds=!0,t.bounds.min.x=r.min.x,t.bounds.max.x=r.min.x+p*v,t.bounds.min.y=r.min.y,t.bounds.max.y=r.min.y+d*g,i&&(t.bounds.min.x+=.5*p-p*v*.5,t.bounds.max.x+=.5*p-p*v*.5,t.bounds.min.y+=.5*d-d*g*.5,t.bounds.max.y+=.5*d-d*g*.5),t.bounds.min.x-=n.x,t.bounds.max.x-=n.x,t.bounds.min.y-=n.y,t.bounds.max.y-=n.y,t.mouse&&(u.setScale(t.mouse,{x:(t.bounds.max.x-t.bounds.min.x)/t.canvas.width,y:(t.bounds.max.y-t.bounds.min.y)/t.canvas.height}),u.setOffset(t.mouse,t.bounds.min))},i.startViewTransform=function(t){var e=t.bounds.max.x-t.bounds.min.x,n=t.bounds.max.y-t.bounds.min.y,i=e/t.options.width,o=n/t.options.height;t.context.scale(1/i,1/o),t.context.translate(-t.bounds.min.x,-t.bounds.min.y)},i.endViewTransform=function(t){t.context.setTransform(t.options.pixelRatio,0,0,t.options.pixelRatio,0,0)},i.world=function(t){var e,n=t.engine,o=n.world,p=t.canvas,d=t.context,h=t.options,y=r.allBodies(o),m=r.allConstraints(o),v=h.wireframes?h.wireframeBackground:h.background,g=[],x=[],b={timestamp:n.timing.timestamp};if(a.trigger(t,"beforeRender",b),t.currentBackground!==v&&f(t,v),d.globalCompositeOperation="source-in",d.fillStyle="transparent",d.fillRect(0,0,p.width,p.height),d.globalCompositeOperation="source-over",h.hasBounds){for(e=0;e<y.length;e++){var w=y[e];s.overlaps(w.bounds,t.bounds)&&g.push(w)}for(e=0;e<m.length;e++){var A=m[e],S=A.bodyA,C=A.bodyB,_=A.pointA,P=A.pointB;S&&(_=c.add(S.position,A.pointA)),C&&(P=c.add(C.position,A.pointB)),_&&P&&(s.contains(t.bounds,_)||s.contains(t.bounds,P))&&x.push(A)}i.startViewTransform(t),t.mouse&&(u.setScale(t.mouse,{x:(t.bounds.max.x-t.bounds.min.x)/t.canvas.width,y:(t.bounds.max.y-t.bounds.min.y)/t.canvas.height}),u.setOffset(t.mouse,t.bounds.min))}else x=m,g=y;!h.wireframes||n.enableSleeping&&h.showSleeping?i.bodies(t,g,d):(h.showConvexHulls&&i.bodyConvexHulls(t,g,d),i.bodyWireframes(t,g,d)),h.showBounds&&i.bodyBounds(t,g,d),(h.showAxes||h.showAngleIndicator)&&i.bodyAxes(t,g,d),h.showPositions&&i.bodyPositions(t,g,d),h.showVelocity&&i.bodyVelocity(t,g,d),h.showIds&&i.bodyIds(t,g,d),h.showSeparations&&i.separations(t,n.pairs.list,d),h.showCollisions&&i.collisions(t,n.pairs.list,d),h.showVertexNumbers&&i.vertexNumbers(t,g,d),h.showMousePosition&&i.mousePosition(t,t.mouse,d),i.constraints(x,d),h.showBroadphase&&n.broadphase.controller===l&&i.grid(t,n.broadphase,d),h.showDebug&&i.debug(t,d),h.hasBounds&&i.endViewTransform(t),a.trigger(t,"afterRender",b)},i.debug=function(t,e){var n=e,i=t.engine,o=i.world,s=i.metrics,a=t.options;if(r.allBodies(o),i.timing.timestamp-(t.debugTimestamp||0)>=500){var l="";s.timing&&(l+="fps: "+Math.round(s.timing.fps)+"    "),t.debugString=l,t.debugTimestamp=i.timing.timestamp}if(t.debugString){n.font="12px Arial",a.wireframes?n.fillStyle="rgba(255,255,255,0.5)":n.fillStyle="rgba(0,0,0,0.5)";for(var c=t.debugString.split("\n"),u=0;u<c.length;u++)n.fillText(c[u],50,50+18*u)}},i.constraints=function(t,e){for(var n=e,i=0;i<t.length;i++){var r=t[i];if(r.render.visible&&r.pointA&&r.pointB){var s,a,l=r.bodyA,u=r.bodyB;if(s=l?c.add(l.position,r.pointA):r.pointA,"pin"===r.render.type)n.beginPath(),n.arc(s.x,s.y,3,0,2*Math.PI),n.closePath();else{if(a=u?c.add(u.position,r.pointB):r.pointB,n.beginPath(),n.moveTo(s.x,s.y),"spring"===r.render.type)for(var p,d=c.sub(a,s),f=c.perp(c.normalise(d)),h=Math.ceil(o.clamp(r.length/5,12,20)),y=1;y<h;y+=1)p=y%2==0?1:-1,n.lineTo(s.x+d.x*(y/h)+f.x*p*4,s.y+d.y*(y/h)+f.y*p*4);n.lineTo(a.x,a.y)}r.render.lineWidth&&(n.lineWidth=r.render.lineWidth,n.strokeStyle=r.render.strokeStyle,n.stroke()),r.render.anchors&&(n.fillStyle=r.render.strokeStyle,n.beginPath(),n.arc(s.x,s.y,3,0,2*Math.PI),n.arc(a.x,a.y,3,0,2*Math.PI),n.closePath(),n.fill())}}},i.bodyShadows=function(t,e,n){for(var i=n,o=(t.engine,0);o<e.length;o++){var r=e[o];if(r.render.visible){if(r.circleRadius)i.beginPath(),i.arc(r.position.x,r.position.y,r.circleRadius,0,2*Math.PI),i.closePath();else{i.beginPath(),i.moveTo(r.vertices[0].x,r.vertices[0].y);for(var s=1;s<r.vertices.length;s++)i.lineTo(r.vertices[s].x,r.vertices[s].y);i.closePath()}var a=r.position.x-.5*t.options.width,l=r.position.y-.2*t.options.height,c=Math.abs(a)+Math.abs(l);i.shadowColor="rgba(0,0,0,0.15)",i.shadowOffsetX=.05*a,i.shadowOffsetY=.05*l,i.shadowBlur=1+12*Math.min(1,c/1e3),i.fill(),i.shadowColor=null,i.shadowOffsetX=null,i.shadowOffsetY=null,i.shadowBlur=null}}},i.bodies=function(t,e,n){var i,o,r,s,a=n,l=(t.engine,t.options),c=l.showInternalEdges||!l.wireframes;for(r=0;r<e.length;r++)if((i=e[r]).render.visible)for(s=i.parts.length>1?1:0;s<i.parts.length;s++)if((o=i.parts[s]).render.visible){if(l.showSleeping&&i.isSleeping?a.globalAlpha=.5*o.render.opacity:1!==o.render.opacity&&(a.globalAlpha=o.render.opacity),o.render.sprite&&o.render.sprite.texture&&!l.wireframes){var u=o.render.sprite,p=d(t,u.texture);a.translate(o.position.x,o.position.y),a.rotate(o.angle),a.drawImage(p,p.width*-u.xOffset*u.xScale,p.height*-u.yOffset*u.yScale,p.width*u.xScale,p.height*u.yScale),a.rotate(-o.angle),a.translate(-o.position.x,-o.position.y)}else{if(o.circleRadius)a.beginPath(),a.arc(o.position.x,o.position.y,o.circleRadius,0,2*Math.PI);else{a.beginPath(),a.moveTo(o.vertices[0].x,o.vertices[0].y);for(var f=1;f<o.vertices.length;f++)!o.vertices[f-1].isInternal||c?a.lineTo(o.vertices[f].x,o.vertices[f].y):a.moveTo(o.vertices[f].x,o.vertices[f].y),o.vertices[f].isInternal&&!c&&a.moveTo(o.vertices[(f+1)%o.vertices.length].x,o.vertices[(f+1)%o.vertices.length].y);a.lineTo(o.vertices[0].x,o.vertices[0].y),a.closePath()}l.wireframes?(a.lineWidth=1,a.strokeStyle="#bbb",a.stroke()):(a.fillStyle=o.render.fillStyle,o.render.lineWidth&&(a.lineWidth=o.render.lineWidth,a.strokeStyle=o.render.strokeStyle,a.stroke()),a.fill())}a.globalAlpha=1}},i.bodyWireframes=function(t,e,n){var i,o,r,s,a,l=n,c=t.options.showInternalEdges;for(l.beginPath(),r=0;r<e.length;r++)if((i=e[r]).render.visible)for(a=i.parts.length>1?1:0;a<i.parts.length;a++){for(o=i.parts[a],l.moveTo(o.vertices[0].x,o.vertices[0].y),s=1;s<o.vertices.length;s++)!o.vertices[s-1].isInternal||c?l.lineTo(o.vertices[s].x,o.vertices[s].y):l.moveTo(o.vertices[s].x,o.vertices[s].y),o.vertices[s].isInternal&&!c&&l.moveTo(o.vertices[(s+1)%o.vertices.length].x,o.vertices[(s+1)%o.vertices.length].y);l.lineTo(o.vertices[0].x,o.vertices[0].y)}l.lineWidth=1,l.strokeStyle="#bbb",l.stroke()},i.bodyConvexHulls=function(t,e,n){var i,o,r,s=n;for(s.beginPath(),o=0;o<e.length;o++)if((i=e[o]).render.visible&&1!==i.parts.length){for(s.moveTo(i.vertices[0].x,i.vertices[0].y),r=1;r<i.vertices.length;r++)s.lineTo(i.vertices[r].x,i.vertices[r].y);s.lineTo(i.vertices[0].x,i.vertices[0].y)}s.lineWidth=1,s.strokeStyle="rgba(255,255,255,0.2)",s.stroke()},i.vertexNumbers=function(t,e,n){var i,o,r,s=n;for(i=0;i<e.length;i++){var a=e[i].parts;for(r=a.length>1?1:0;r<a.length;r++){var l=a[r];for(o=0;o<l.vertices.length;o++)s.fillStyle="rgba(255,255,255,0.2)",s.fillText(i+"_"+o,l.position.x+.8*(l.vertices[o].x-l.position.x),l.position.y+.8*(l.vertices[o].y-l.position.y))}}},i.mousePosition=function(t,e,n){var i=n;i.fillStyle="rgba(255,255,255,0.8)",i.fillText(e.position.x+"  "+e.position.y,e.position.x+5,e.position.y-5)},i.bodyBounds=function(t,e,n){var i=n,o=(t.engine,t.options);i.beginPath();for(var r=0;r<e.length;r++){var s=e[r];if(s.render.visible)for(var a=e[r].parts,l=a.length>1?1:0;l<a.length;l++){var c=a[l];i.rect(c.bounds.min.x,c.bounds.min.y,c.bounds.max.x-c.bounds.min.x,c.bounds.max.y-c.bounds.min.y)}}o.wireframes?i.strokeStyle="rgba(255,255,255,0.08)":i.strokeStyle="rgba(0,0,0,0.1)",i.lineWidth=1,i.stroke()},i.bodyAxes=function(t,e,n){var i,o,r,s,a=n,l=(t.engine,t.options);for(a.beginPath(),o=0;o<e.length;o++){var c=e[o],u=c.parts;if(c.render.visible)if(l.showAxes)for(r=u.length>1?1:0;r<u.length;r++)for(i=u[r],s=0;s<i.axes.length;s++){var p=i.axes[s];a.moveTo(i.position.x,i.position.y),a.lineTo(i.position.x+20*p.x,i.position.y+20*p.y)}else for(r=u.length>1?1:0;r<u.length;r++)for(i=u[r],s=0;s<i.axes.length;s++)a.moveTo(i.position.x,i.position.y),a.lineTo((i.vertices[0].x+i.vertices[i.vertices.length-1].x)/2,(i.vertices[0].y+i.vertices[i.vertices.length-1].y)/2)}l.wireframes?(a.strokeStyle="indianred",a.lineWidth=1):(a.strokeStyle="rgba(255, 255, 255, 0.4)",a.globalCompositeOperation="overlay",a.lineWidth=2),a.stroke(),a.globalCompositeOperation="source-over"},i.bodyPositions=function(t,e,n){var i,o,r,s,a=n,l=(t.engine,t.options);for(a.beginPath(),r=0;r<e.length;r++)if((i=e[r]).render.visible)for(s=0;s<i.parts.length;s++)o=i.parts[s],a.arc(o.position.x,o.position.y,3,0,2*Math.PI,!1),a.closePath();for(l.wireframes?a.fillStyle="indianred":a.fillStyle="rgba(0,0,0,0.5)",a.fill(),a.beginPath(),r=0;r<e.length;r++)(i=e[r]).render.visible&&(a.arc(i.positionPrev.x,i.positionPrev.y,2,0,2*Math.PI,!1),a.closePath());a.fillStyle="rgba(255,165,0,0.8)",a.fill()},i.bodyVelocity=function(t,e,n){var i=n;i.beginPath();for(var o=0;o<e.length;o++){var r=e[o];r.render.visible&&(i.moveTo(r.position.x,r.position.y),i.lineTo(r.position.x+2*(r.position.x-r.positionPrev.x),r.position.y+2*(r.position.y-r.positionPrev.y)))}i.lineWidth=3,i.strokeStyle="cornflowerblue",i.stroke()},i.bodyIds=function(t,e,n){var i,o,r=n;for(i=0;i<e.length;i++)if(e[i].render.visible){var s=e[i].parts;for(o=s.length>1?1:0;o<s.length;o++){var a=s[o];r.font="12px Arial",r.fillStyle="rgba(255,255,255,0.5)",r.fillText(a.id,a.position.x+10,a.position.y-10)}}},i.collisions=function(t,e,n){var i,o,r,s,a=n,l=t.options;for(a.beginPath(),r=0;r<e.length;r++)if((i=e[r]).isActive)for(o=i.collision,s=0;s<i.activeContacts.length;s++){var c=i.activeContacts[s],u=c.vertex;a.rect(u.x-1.5,u.y-1.5,3.5,3.5)}for(l.wireframes?a.fillStyle="rgba(255,255,255,0.7)":a.fillStyle="orange",a.fill(),a.beginPath(),r=0;r<e.length;r++)if((i=e[r]).isActive&&(o=i.collision,i.activeContacts.length>0)){var p=i.activeContacts[0].vertex.x,d=i.activeContacts[0].vertex.y;2===i.activeContacts.length&&(p=(i.activeContacts[0].vertex.x+i.activeContacts[1].vertex.x)/2,d=(i.activeContacts[0].vertex.y+i.activeContacts[1].vertex.y)/2),o.bodyB===o.supports[0].body||!0===o.bodyA.isStatic?a.moveTo(p-8*o.normal.x,d-8*o.normal.y):a.moveTo(p+8*o.normal.x,d+8*o.normal.y),a.lineTo(p,d)}l.wireframes?a.strokeStyle="rgba(255,165,0,0.7)":a.strokeStyle="orange",a.lineWidth=1,a.stroke()},i.separations=function(t,e,n){var i,o,r,s,a,l=n,c=t.options;for(l.beginPath(),a=0;a<e.length;a++)if((i=e[a]).isActive){o=i.collision,r=o.bodyA,s=o.bodyB;var u=1;s.isStatic||r.isStatic||(u=.5),s.isStatic&&(u=0),l.moveTo(s.position.x,s.position.y),l.lineTo(s.position.x-o.penetration.x*u,s.position.y-o.penetration.y*u),u=1,s.isStatic||r.isStatic||(u=.5),r.isStatic&&(u=0),l.moveTo(r.position.x,r.position.y),l.lineTo(r.position.x+o.penetration.x*u,r.position.y+o.penetration.y*u)}c.wireframes?l.strokeStyle="rgba(255,165,0,0.5)":l.strokeStyle="orange",l.stroke()},i.grid=function(t,e,n){var i=n,r=t.options;r.wireframes?i.strokeStyle="rgba(255,180,0,0.1)":i.strokeStyle="rgba(255,180,0,0.5)",i.beginPath();for(var s=o.keys(e.buckets),a=0;a<s.length;a++){var l=s[a];if(!(e.buckets[l].length<2)){var c=l.split(/C|R/);i.rect(.5+parseInt(c[1],10)*e.bucketWidth,.5+parseInt(c[2],10)*e.bucketHeight,e.bucketWidth,e.bucketHeight)}}i.lineWidth=1,i.stroke()},i.inspector=function(t,e){t.engine;var n,i=t.selected,o=t.render,r=o.options;if(r.hasBounds){var s=o.bounds.max.x-o.bounds.min.x,a=o.bounds.max.y-o.bounds.min.y,l=s/o.options.width,c=a/o.options.height;e.scale(1/l,1/c),e.translate(-o.bounds.min.x,-o.bounds.min.y)}for(var u=0;u<i.length;u++){var p=i[u].data;switch(e.translate(.5,.5),e.lineWidth=1,e.strokeStyle="rgba(255,165,0,0.9)",e.setLineDash([1,2]),p.type){case"body":n=p.bounds,e.beginPath(),e.rect(Math.floor(n.min.x-3),Math.floor(n.min.y-3),Math.floor(n.max.x-n.min.x+6),Math.floor(n.max.y-n.min.y+6)),e.closePath(),e.stroke();break;case"constraint":var d=p.pointA;p.bodyA&&(d=p.pointB),e.beginPath(),e.arc(d.x,d.y,10,0,2*Math.PI),e.closePath(),e.stroke()}e.setLineDash([]),e.translate(-.5,-.5)}null!==t.selectStart&&(e.translate(.5,.5),e.lineWidth=1,e.strokeStyle="rgba(255,165,0,0.6)",e.fillStyle="rgba(255,165,0,0.1)",n=t.selectBounds,e.beginPath(),e.rect(Math.floor(n.min.x),Math.floor(n.min.y),Math.floor(n.max.x-n.min.x),Math.floor(n.max.y-n.min.y)),e.closePath(),e.stroke(),e.fill(),e.translate(-.5,-.5)),r.hasBounds&&e.setTransform(1,0,0,1,0,0)};var n=function(t,e){var n=document.createElement("canvas");return n.width=t,n.height=e,n.oncontextmenu=function(){return!1},n.onselectstart=function(){return!1},n},p=function(t){var e=t.getContext("2d"),n=window.devicePixelRatio||1,i=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return n/i},d=function(t,e){var n=t.textures[e];return n||((n=t.textures[e]=new Image).src=e,n)},f=function(t,e){var n=e;/(jpg|gif|png)$/.test(e)&&(n="url("+e+")"),t.canvas.style.background=n,t.canvas.style.backgroundSize="contain",t.currentBackground=e}}()},{"../body/Composite":2,"../collision/Grid":6,"../core/Common":14,"../core/Events":16,"../core/Mouse":19,"../geometry/Bounds":26,"../geometry/Vector":28}],32:[function(t,e,n){var i={};e.exports=i;var o=t("../geometry/Bounds"),r=t("../body/Composite"),s=t("../core/Common"),a=t("../core/Events"),l=t("../geometry/Vector");!function(){var t,e;"undefined"!=typeof window&&(t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(function(){t(s.now())},1e3/60)},e=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),i.create=function(t){s.warn("RenderPixi.create: Matter.RenderPixi is deprecated (see docs)");var e={controller:i,engine:null,element:null,frameRequestId:null,canvas:null,renderer:null,container:null,spriteContainer:null,pixiOptions:null,options:{width:800,height:600,background:"#fafafa",wireframeBackground:"#222",hasBounds:!1,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1}},n=s.extend(e,t),o=!n.options.wireframes&&"transparent"===n.options.background;return n.pixiOptions=n.pixiOptions||{view:n.canvas,transparent:o,antialias:!0,backgroundColor:t.background},n.mouse=t.mouse,n.engine=t.engine,n.renderer=n.renderer||new PIXI.WebGLRenderer(n.options.width,n.options.height,n.pixiOptions),n.container=n.container||new PIXI.Container,n.spriteContainer=n.spriteContainer||new PIXI.Container,n.canvas=n.canvas||n.renderer.view,n.bounds=n.bounds||{min:{x:0,y:0},max:{x:n.options.width,y:n.options.height}},a.on(n.engine,"beforeUpdate",function(){i.clear(n)}),n.textures={},n.sprites={},n.primitives={},n.container.addChild(n.spriteContainer),s.isElement(n.element)?n.element.appendChild(n.canvas):s.warn('No "render.element" passed, "render.canvas" was not inserted into document.'),n.canvas.oncontextmenu=function(){return!1},n.canvas.onselectstart=function(){return!1},n},i.run=function(e){!function n(o){e.frameRequestId=t(n),i.world(e)}()},i.stop=function(t){e(t.frameRequestId)},i.clear=function(t){for(var e=t.container,n=t.spriteContainer;e.children[0];)e.removeChild(e.children[0]);for(;n.children[0];)n.removeChild(n.children[0]);var i=t.sprites["bg-0"];t.textures={},t.sprites={},t.primitives={},t.sprites["bg-0"]=i,i&&e.addChildAt(i,0),t.container.addChild(t.spriteContainer),t.currentBackground=null,e.scale.set(1,1),e.position.set(0,0)},i.setBackground=function(t,e){if(t.currentBackground!==e){var n=e.indexOf&&-1!==e.indexOf("#"),i=t.sprites["bg-0"];if(n){var o=s.colorToNumber(e);t.renderer.backgroundColor=o,i&&t.container.removeChild(i)}else if(!i){var r=u(t,e);(i=t.sprites["bg-0"]=new PIXI.Sprite(r)).position.x=0,i.position.y=0,t.container.addChildAt(i,0)}t.currentBackground=e}},i.world=function(t){var e,n=t.engine,s=n.world,a=t.renderer,c=t.container,u=t.options,p=r.allBodies(s),d=r.allConstraints(s),f=[];u.wireframes?i.setBackground(t,u.wireframeBackground):i.setBackground(t,u.background);var h=t.bounds.max.x-t.bounds.min.x,y=t.bounds.max.y-t.bounds.min.y,m=h/t.options.width,v=y/t.options.height;if(u.hasBounds){for(e=0;e<p.length;e++){var g=p[e];g.render.sprite.visible=o.overlaps(g.bounds,t.bounds)}for(e=0;e<d.length;e++){var x=d[e],b=x.bodyA,w=x.bodyB,A=x.pointA,S=x.pointB;b&&(A=l.add(b.position,x.pointA)),w&&(S=l.add(w.position,x.pointB)),A&&S&&(o.contains(t.bounds,A)||o.contains(t.bounds,S))&&f.push(x)}c.scale.set(1/m,1/v),c.position.set(-t.bounds.min.x*(1/m),-t.bounds.min.y*(1/v))}else f=d;for(e=0;e<p.length;e++)i.body(t,p[e]);for(e=0;e<f.length;e++)i.constraint(t,f[e]);a.render(c)},i.constraint=function(t,e){t.engine;var n=e.bodyA,i=e.bodyB,o=e.pointA,r=e.pointB,a=t.container,l=e.render,c="c-"+e.id,u=t.primitives[c];u||(u=t.primitives[c]=new PIXI.Graphics),l.visible&&e.pointA&&e.pointB?(-1===s.indexOf(a.children,u)&&a.addChild(u),u.clear(),u.beginFill(0,0),u.lineStyle(l.lineWidth,s.colorToNumber(l.strokeStyle),1),n?u.moveTo(n.position.x+o.x,n.position.y+o.y):u.moveTo(o.x,o.y),i?u.lineTo(i.position.x+r.x,i.position.y+r.y):u.lineTo(r.x,r.y),u.endFill()):u.clear()},i.body=function(t,e){t.engine;var i=e.render;if(i.visible)if(i.sprite&&i.sprite.texture){var o="b-"+e.id,r=t.sprites[o],a=t.spriteContainer;r||(r=t.sprites[o]=n(t,e)),-1===s.indexOf(a.children,r)&&a.addChild(r),r.position.x=e.position.x,r.position.y=e.position.y,r.rotation=e.angle,r.scale.x=i.sprite.xScale||1,r.scale.y=i.sprite.yScale||1}else{var l="b-"+e.id,u=t.primitives[l],p=t.container;u||((u=t.primitives[l]=c(t,e)).initialAngle=e.angle),-1===s.indexOf(p.children,u)&&p.addChild(u),u.position.x=e.position.x,u.position.y=e.position.y,u.rotation=e.angle-u.initialAngle}};var n=function(t,e){var n=e.render,i=n.sprite.texture,o=u(t,i),r=new PIXI.Sprite(o);return r.anchor.x=e.render.sprite.xOffset,r.anchor.y=e.render.sprite.yOffset,r},c=function(t,e){var n,i=e.render,o=t.options,r=new PIXI.Graphics,a=s.colorToNumber(i.fillStyle),l=s.colorToNumber(i.strokeStyle),c=s.colorToNumber(i.strokeStyle),u=s.colorToNumber("#bbb"),p=s.colorToNumber("#CD5C5C");r.clear();for(var d=e.parts.length>1?1:0;d<e.parts.length;d++){n=e.parts[d],o.wireframes?(r.beginFill(0,0),r.lineStyle(1,u,1)):(r.beginFill(a,1),r.lineStyle(i.lineWidth,l,1)),r.moveTo(n.vertices[0].x-e.position.x,n.vertices[0].y-e.position.y);for(var f=1;f<n.vertices.length;f++)r.lineTo(n.vertices[f].x-e.position.x,n.vertices[f].y-e.position.y);r.lineTo(n.vertices[0].x-e.position.x,n.vertices[0].y-e.position.y),r.endFill(),(o.showAngleIndicator||o.showAxes)&&(r.beginFill(0,0),o.wireframes?r.lineStyle(1,p,1):r.lineStyle(1,c),r.moveTo(n.position.x-e.position.x,n.position.y-e.position.y),r.lineTo((n.vertices[0].x+n.vertices[n.vertices.length-1].x)/2-e.position.x,(n.vertices[0].y+n.vertices[n.vertices.length-1].y)/2-e.position.y),r.endFill())}return r},u=function(t,e){var n=t.textures[e];return n||(n=t.textures[e]=PIXI.Texture.fromImage(e)),n}}()},{"../body/Composite":2,"../core/Common":14,"../core/Events":16,"../geometry/Bounds":26,"../geometry/Vector":28}]},{},[30])(30)}).call(this,n(17))},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){var i;
/*!
 * EventEmitter v5.2.5 - git.io/ee
 * Unlicense - http://unlicense.org/
 * Oliver Caldwell - http://oli.me.uk/
 * @preserve
 */!function(e){"use strict";function o(){}var r=o.prototype,s=e.EventEmitter;function a(t,e){for(var n=t.length;n--;)if(t[n].listener===e)return n;return-1}function l(t){return function(){return this[t].apply(this,arguments)}}r.getListeners=function(t){var e,n,i=this._getEvents();if(t instanceof RegExp)for(n in e={},i)i.hasOwnProperty(n)&&t.test(n)&&(e[n]=i[n]);else e=i[t]||(i[t]=[]);return e},r.flattenListeners=function(t){var e,n=[];for(e=0;e<t.length;e+=1)n.push(t[e].listener);return n},r.getListenersAsObject=function(t){var e,n=this.getListeners(t);return n instanceof Array&&((e={})[t]=n),e||n},r.addListener=function(t,e){if(!function t(e){return"function"==typeof e||e instanceof RegExp||!(!e||"object"!=typeof e)&&t(e.listener)}(e))throw new TypeError("listener must be a function");var n,i=this.getListenersAsObject(t),o="object"==typeof e;for(n in i)i.hasOwnProperty(n)&&-1===a(i[n],e)&&i[n].push(o?e:{listener:e,once:!1});return this},r.on=l("addListener"),r.addOnceListener=function(t,e){return this.addListener(t,{listener:e,once:!0})},r.once=l("addOnceListener"),r.defineEvent=function(t){return this.getListeners(t),this},r.defineEvents=function(t){for(var e=0;e<t.length;e+=1)this.defineEvent(t[e]);return this},r.removeListener=function(t,e){var n,i,o=this.getListenersAsObject(t);for(i in o)o.hasOwnProperty(i)&&-1!==(n=a(o[i],e))&&o[i].splice(n,1);return this},r.off=l("removeListener"),r.addListeners=function(t,e){return this.manipulateListeners(!1,t,e)},r.removeListeners=function(t,e){return this.manipulateListeners(!0,t,e)},r.manipulateListeners=function(t,e,n){var i,o,r=t?this.removeListener:this.addListener,s=t?this.removeListeners:this.addListeners;if("object"!=typeof e||e instanceof RegExp)for(i=n.length;i--;)r.call(this,e,n[i]);else for(i in e)e.hasOwnProperty(i)&&(o=e[i])&&("function"==typeof o?r.call(this,i,o):s.call(this,i,o));return this},r.removeEvent=function(t){var e,n=typeof t,i=this._getEvents();if("string"===n)delete i[t];else if(t instanceof RegExp)for(e in i)i.hasOwnProperty(e)&&t.test(e)&&delete i[e];else delete this._events;return this},r.removeAllListeners=l("removeEvent"),r.emitEvent=function(t,e){var n,i,o,r,s=this.getListenersAsObject(t);for(r in s)if(s.hasOwnProperty(r))for(n=s[r].slice(0),o=0;o<n.length;o++)!0===(i=n[o]).once&&this.removeListener(t,i.listener),i.listener.apply(this,e||[])===this._getOnceReturnValue()&&this.removeListener(t,i.listener);return this},r.trigger=l("emitEvent"),r.emit=function(t){var e=Array.prototype.slice.call(arguments,1);return this.emitEvent(t,e)},r.setOnceReturnValue=function(t){return this._onceReturnValue=t,this},r._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},r._getEvents=function(){return this._events||(this._events={})},o.noConflict=function(){return e.EventEmitter=s,o},void 0===(i=function(){return o}.call(e,n,e,t))||(t.exports=i)}("undefined"!=typeof window?window:this||{})},function(t,e,n){"use strict";(function(e){function n(t){if("string"!=typeof t)throw new TypeError("Path must be a string. Received "+JSON.stringify(t))}function i(t,e){for(var n,i="",o=0,r=-1,s=0,a=0;a<=t.length;++a){if(a<t.length)n=t.charCodeAt(a);else{if(47===n)break;n=47}if(47===n){if(r===a-1||1===s);else if(r!==a-1&&2===s){if(i.length<2||2!==o||46!==i.charCodeAt(i.length-1)||46!==i.charCodeAt(i.length-2))if(i.length>2){var l=i.lastIndexOf("/");if(l!==i.length-1){-1===l?(i="",o=0):o=(i=i.slice(0,l)).length-1-i.lastIndexOf("/"),r=a,s=0;continue}}else if(2===i.length||1===i.length){i="",o=0,r=a,s=0;continue}e&&(i.length>0?i+="/..":i="..",o=2)}else i.length>0?i+="/"+t.slice(r+1,a):i=t.slice(r+1,a),o=a-r-1;r=a,s=0}else 46===n&&-1!==s?++s:s=-1}return i}var o={resolve:function(){for(var t,o="",r=!1,s=arguments.length-1;s>=-1&&!r;s--){var a;s>=0?a=arguments[s]:(void 0===t&&(t=e.cwd()),a=t),n(a),0!==a.length&&(o=a+"/"+o,r=47===a.charCodeAt(0))}return o=i(o,!r),r?o.length>0?"/"+o:"/":o.length>0?o:"."},normalize:function(t){if(n(t),0===t.length)return".";var e=47===t.charCodeAt(0),o=47===t.charCodeAt(t.length-1);return 0!==(t=i(t,!e)).length||e||(t="."),t.length>0&&o&&(t+="/"),e?"/"+t:t},isAbsolute:function(t){return n(t),t.length>0&&47===t.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var t,e=0;e<arguments.length;++e){var i=arguments[e];n(i),i.length>0&&(void 0===t?t=i:t+="/"+i)}return void 0===t?".":o.normalize(t)},relative:function(t,e){if(n(t),n(e),t===e)return"";if((t=o.resolve(t))===(e=o.resolve(e)))return"";for(var i=1;i<t.length&&47===t.charCodeAt(i);++i);for(var r=t.length,s=r-i,a=1;a<e.length&&47===e.charCodeAt(a);++a);for(var l=e.length-a,c=s<l?s:l,u=-1,p=0;p<=c;++p){if(p===c){if(l>c){if(47===e.charCodeAt(a+p))return e.slice(a+p+1);if(0===p)return e.slice(a+p)}else s>c&&(47===t.charCodeAt(i+p)?u=p:0===p&&(u=0));break}var d=t.charCodeAt(i+p);if(d!==e.charCodeAt(a+p))break;47===d&&(u=p)}var f="";for(p=i+u+1;p<=r;++p)p!==r&&47!==t.charCodeAt(p)||(0===f.length?f+="..":f+="/..");return f.length>0?f+e.slice(a+u):(a+=u,47===e.charCodeAt(a)&&++a,e.slice(a))},_makeLong:function(t){return t},dirname:function(t){if(n(t),0===t.length)return".";for(var e=t.charCodeAt(0),i=47===e,o=-1,r=!0,s=t.length-1;s>=1;--s)if(47===(e=t.charCodeAt(s))){if(!r){o=s;break}}else r=!1;return-1===o?i?"/":".":i&&1===o?"//":t.slice(0,o)},basename:function(t,e){if(void 0!==e&&"string"!=typeof e)throw new TypeError('"ext" argument must be a string');n(t);var i,o=0,r=-1,s=!0;if(void 0!==e&&e.length>0&&e.length<=t.length){if(e.length===t.length&&e===t)return"";var a=e.length-1,l=-1;for(i=t.length-1;i>=0;--i){var c=t.charCodeAt(i);if(47===c){if(!s){o=i+1;break}}else-1===l&&(s=!1,l=i+1),a>=0&&(c===e.charCodeAt(a)?-1==--a&&(r=i):(a=-1,r=l))}return o===r?r=l:-1===r&&(r=t.length),t.slice(o,r)}for(i=t.length-1;i>=0;--i)if(47===t.charCodeAt(i)){if(!s){o=i+1;break}}else-1===r&&(s=!1,r=i+1);return-1===r?"":t.slice(o,r)},extname:function(t){n(t);for(var e=-1,i=0,o=-1,r=!0,s=0,a=t.length-1;a>=0;--a){var l=t.charCodeAt(a);if(47!==l)-1===o&&(r=!1,o=a+1),46===l?-1===e?e=a:1!==s&&(s=1):-1!==e&&(s=-1);else if(!r){i=a+1;break}}return-1===e||-1===o||0===s||1===s&&e===o-1&&e===i+1?"":t.slice(e,o)},format:function(t){if(null===t||"object"!=typeof t)throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof t);return function(t,e){var n=e.dir||e.root,i=e.base||(e.name||"")+(e.ext||"");return n?n===e.root?n+i:n+t+i:i}("/",t)},parse:function(t){n(t);var e={root:"",dir:"",base:"",ext:"",name:""};if(0===t.length)return e;var i,o=t.charCodeAt(0),r=47===o;r?(e.root="/",i=1):i=0;for(var s=-1,a=0,l=-1,c=!0,u=t.length-1,p=0;u>=i;--u)if(47!==(o=t.charCodeAt(u)))-1===l&&(c=!1,l=u+1),46===o?-1===s?s=u:1!==p&&(p=1):-1!==s&&(p=-1);else if(!c){a=u+1;break}return-1===s||-1===l||0===p||1===p&&s===l-1&&s===a+1?-1!==l&&(e.base=e.name=0===a&&r?t.slice(1,l):t.slice(a,l)):(0===a&&r?(e.name=t.slice(1,s),e.base=t.slice(1,l)):(e.name=t.slice(a,s),e.base=t.slice(a,l)),e.ext=t.slice(s,l)),a>0?e.dir=t.slice(0,a-1):r&&(e.dir="/"),e},sep:"/",delimiter:":",win32:null,posix:null};o.posix=o,t.exports=o}).call(this,n(20))},function(t,e){var n,i,o=t.exports={};function r(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(t){if(n===setTimeout)return setTimeout(t,0);if((n===r||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:r}catch(t){n=r}try{i="function"==typeof clearTimeout?clearTimeout:s}catch(t){i=s}}();var l,c=[],u=!1,p=-1;function d(){u&&l&&(u=!1,l.length?c=l.concat(c):p=-1,c.length&&f())}function f(){if(!u){var t=a(d);u=!0;for(var e=c.length;e;){for(l=c,c=[];++p<e;)l&&l[p].run();p=-1,e=c.length}l=null,u=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(t)}}function h(t,e){this.fun=t,this.array=e}function y(){}o.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];c.push(new h(t,e)),1!==c.length||u||a(f)},h.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=y,o.addListener=y,o.once=y,o.off=y,o.removeListener=y,o.removeAllListeners=y,o.emit=y,o.prependListener=y,o.prependOnceListener=y,o.listeners=function(t){return[]},o.binding=function(t){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(t){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(t,e,n){"use strict";var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});e.__esModule=!0;var r=function(t){function e(e,n){var i=t.call(this)||this;return i.game=e,i.dir=n,i}return o(e,t),e.prototype.execute=function(){t.prototype.execute.call(this);var e=this.game.player.entity;e.targetMovement.stopMoving(),e.dirMovement.goDirection(this.dir)},e.prototype.finish=function(){t.prototype.finish.call(this);var e=this.game.player.entity;e.targetMovement.stopMoving(),e.dirMovement.stopGoDirection(this.dir)},e}(n(22).default);e.default=r},function(t,e,n){"use strict";e.__esModule=!0;var i=function(){function t(){this.isRunning=!1}return t.prototype.execute=function(){this.isRunning=!0},t.prototype.isExecuted=function(){return this.isRunning},t.prototype.finish=function(){this.isRunning=!1},t}();e.default=i},function(t,e,n){"use strict";e.__esModule=!0;var i=function(){function t(t,e){this.delta=0,this.game=t,this.delta=e}return t.prototype.execute=function(){this.game.gameCamera.changeScale(this.delta)},t}();e.default=i},function(t,e,n){"use strict";e.__esModule=!0;var i=function(){function t(t){this.game=t}return t.prototype.execute=function(t){var e=this.game.player.entity;e.dirMovement.stopMoving();var n=this.game.gameCamera.getPositionByMouseEvent(t);e.targetMovement.goTarget(n)},t}();e.default=i},function(t,e,n){"use strict";e.__esModule=!0;var i=n(8),o=function(){function t(t){this.game=t}return t.prototype.execute=function(t){for(var e=this.game.player.entity,n=this.game.gameCamera.getPositionByMouseEvent(t),o=0,r=this.game.entitiesManager.findAll(n);o<r.length;o++){var s=r[o];if(s instanceof i.default){if(e.getPosition().distance(s.getPosition())>20)continue;s.opened?s.closeDoor():s.openDoor()}}},t}();e.default=o},function(t,e,n){"use strict";e.__esModule=!0;var i=n(0),o=n(27),r=n(2),s=function(){function t(t,e){this.gameImage=t,this.tiles=e}return t.prototype.getAnimation=function(t){return new o.GameAnimation(this,t)},t.fromArrays=function(e,n,o){for(var s=[],a=i.Victor.fromArray(n),l=0;l<o.length;l+=2){var c=new i.Victor(o[l],o[l+1]);s.push(new r.default(e,a,c))}return new t(e,s)},t}();e.default=s},function(t,e,n){"use strict";var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});e.__esModule=!0;var r=function(t){function e(e,n){var i=t.call(this)||this;return i.duration=1e3,i.frame=0,i.frameTime=0,i.frameRate=0,i._loop=!0,i._reverse=!1,i.animationDef=e,i.mainloop=n,i.frameRate=i.duration/i.animationDef.tiles.length,i.done=!1,i}return o(e,t),e.prototype.setDuration=function(t){return this.duration=t,this.frameRate=this.duration/this.animationDef.tiles.length,this},e.prototype.loop=function(t){return void 0===t&&(t=!0),this._loop=t,this},e.prototype.reverse=function(t){return void 0===t&&(t=!0),this._reverse=t,this},e.prototype.getTile=function(t){return this.animationDef.tiles[t]},e.prototype.getCurrentTile=function(){return this.animationDef.tiles[this.frame]},e.prototype.playFromBeginning=function(){return this.frame=0,this.done=!1,this._reverse=!1,this},e.prototype.playFromEnding=function(){return this.frame=this.animationDef.tiles.length-1,this._reverse=!0,this.done=!1,this},e.prototype.update=function(){if(!this.done){var t=this.mainloop.dt;this.frameTime+=t,this.frameTime>this.frameRate&&(this.frame=this.frame+(this._reverse?-1:1),this.frameTime=0,this._reverse?-1===this.frame&&(this.frame=this.animationDef.tiles.length-1,this._loop||(this.done=!0,this.emit("done"))):this.frame===this.animationDef.tiles.length&&(this.frame=0,this._loop||(this.done=!0,this.emit("done"))))}},e}(n(0).EventEmitter);e.GameAnimation=r},function(t,e,n){"use strict";e.__esModule=!0;var i=n(0),o=function(){function t(t){this.leftTopPosition=new i.Victor(0,0),this.positionableObject=t}return t.prototype.left=function(t){return this.leftTopPosition.x=t,this},t.prototype.right=function(t){return this.leftTopPosition.x=t-this.positionableObject.getSize().x,this},t.prototype.top=function(t){return this.leftTopPosition.y=t,this},t.prototype.bottom=function(t){return this.leftTopPosition.y=t-this.positionableObject.getSize().y,this},t.prototype.centerX=function(t){return this.leftTopPosition.x=t-this.positionableObject.getSize().x/2,this},t.prototype.centerY=function(t){return this.leftTopPosition.y=t-this.positionableObject.getSize().y/2,this},t.prototype.center=function(t){return this.leftTopPosition.x=t.x-this.positionableObject.getSize().x/2,this.leftTopPosition.y=t.y-this.positionableObject.getSize().y/2,this},t.prototype.setLeftTopPosition=function(){return this.positionableObject.setLeftTopPosition(this.leftTopPosition),this},t}();e.default=o},function(t,e,n){"use strict";e.__esModule=!0;var i=n(0),o=function(){function t(){this.positionOfCenterInWorld=new i.Victor(0,0),this.size=new i.Victor(0,0),this.killed=!1,this.zindex=0}return t.prototype.kill=function(){this.killed=!0},t.prototype.setPosition=function(t){this.positionOfCenterInWorld.x=t.x,this.positionOfCenterInWorld.y=t.y},t.prototype.getPosition=function(){return this.positionOfCenterInWorld},t.prototype.getLeftTopPosition=function(){var t=new i.Victor(0,0);return t.x=this.positionOfCenterInWorld.x-this.size.x/2,t.y=this.positionOfCenterInWorld.y-this.size.y/2,t},t.prototype.update=function(){},t.prototype.draw=function(){},t}();e.default=o},function(t,e,n){"use strict";e.__esModule=!0;var i=function(){function t(t){this.timestamp=0,this.dt=0,this.timeOfLastUpdate=0,this.done=!1,this.updatableObject=t}return t.prototype.run=function(){var t=this;this.done=!1;var e=function(){t.done||(t.timestamp=performance.now(),t.dt=t.timestamp-t.timeOfLastUpdate,t.timeOfLastUpdate=t.timestamp,t.updatableObject&&t.updatableObject.update(),requestAnimationFrame(e))};this.timeOfLastUpdate=performance.now(),requestAnimationFrame(e)},t.prototype.stop=function(){this.done=!0},t}();e.Mainloop=i},function(t,e,n){"use strict";e.__esModule=!0;var i=n(0),o=function(){function t(t){this.size=new i.Victor(0,0),this.positionInWorld=new i.Victor(0,0),this.scale=new i.Victor(1,1),this.positionForFollow=null,this.canvas=t}return t.prototype.init=function(){var t=this,e=function(){t.updateSize()};return e(),this.canvas.on("resize",e),this},t.prototype.getPositionByMouseEvent=function(t){var e=this.canvas.canvasEl.width,n=this.canvas.canvasEl.height,o=this.size.x,r=this.size.y,s=o*(t.clientX/e)+this.positionInWorld.x,a=r*(t.clientY/n)+this.positionInWorld.y;return new i.Victor(s,a)},t.prototype.changeScale=function(t){return this.scale.x+=t,this.scale.y+=t,this.scale.x<.1&&(this.scale.x=.1),this.scale.y<.1&&(this.scale.y=.1),this.updateSize(),this},t.prototype.setScale=function(t){return this.scale.x=t.x,this.scale.y=t.y,this.updateSize(),this},t.prototype.updateSize=function(){this.size.x=this.canvas.canvasEl.width/this.scale.x,this.size.y=this.canvas.canvasEl.height/this.scale.y},t.prototype.applyWorldBounds=function(){null!=this.worldBounds.right&&(this.positionInWorld.x=Math.min(this.positionInWorld.x,this.worldBounds.right-this.size.x)),null!=this.worldBounds.bottom&&(this.positionInWorld.y=Math.min(this.positionInWorld.y,this.worldBounds.bottom-this.size.y)),null!=this.worldBounds.left&&(this.positionInWorld.x=Math.max(this.positionInWorld.x,this.worldBounds.left)),null!=this.worldBounds.top&&(this.positionInWorld.y=Math.max(this.positionInWorld.y,this.worldBounds.top))},t.prototype.centerAt=function(t){this.positionInWorld.x=t.x-this.size.x/2,this.positionInWorld.y=t.y-this.size.y/2,this.worldBounds&&this.applyWorldBounds()},t.prototype.follow=function(t){return this.positionForFollow=t,this},t.prototype.update=function(){this.positionForFollow&&this.centerAt(this.positionForFollow),null!=this.worldBounds&&this.applyWorldBounds()},t.prototype.begin=function(){var t=this.canvas.context,e=this.positionInWorld.x,n=this.positionInWorld.y;t.save(),t.translate(-e*this.scale.x,-n*this.scale.y),t.scale(this.scale.x,this.scale.y)},t.prototype.end=function(){this.canvas.context.restore()},t}();e.default=o},function(t,e,n){"use strict";e.__esModule=!0;var i=n(33),o=n(7),r=n(0),s=function(){function t(t){this.game=t}return t.prototype.init=function(){this.entity=new i.default(this.game),this.entity.init(),this.entity.setPosition(new r.Victor(872,792)),this.game.entitiesManager.addEntity(this.entity),this.game.eventManager.onOnlyKeyDwon("a",o.moveLeftAction),this.game.eventManager.onOnlyKeyDwon("d",o.moveRightAction),this.game.eventManager.onOnlyKeyDwon("w",o.moveUpAction),this.game.eventManager.onOnlyKeyDwon("s",o.moveDownAction),this.game.eventManager.onScrollDown(o.cameraZoomOutAction),this.game.eventManager.onScrollUp(o.cameraZoomInAction),this.game.eventManager.onRightClick(o.moveToTargetAction),this.game.eventManager.onLeftClick(o.clickAction)},t}();e.default=s},function(t,e,n){"use strict";var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});e.__esModule=!0;var r=n(9),s=n(0),a=n(4),l=n(1),c=n(3),u=n(10),p=n(11),d=n(34),f=n(35),h=function(t){function e(e){var n=t.call(this)||this;return n.isAnimation=!1,n.isPunch=!1,n.speed=2,n.dirMovement=new d.default,n.bodyRadius=4,n.bodyVelocity=s.Matter.Vector.create(0,0),n.game=e,n.sprite=new u.default(n.game.canvas),n.sprite.setTile(c.HERO_IDLE_DOWN),n.targetMovement=new f.default(n),n}return o(e,t),e.prototype.init=function(){this.walkUp=r.HERO_WALK_UP.getAnimation(this.game.mainloop),this.walkDown=r.HERO_WALK_DOWN.getAnimation(this.game.mainloop),this.walkLeft=r.HERO_WALK_LEFT.getAnimation(this.game.mainloop),this.walkRight=r.HERO_WALK_RIGHT.getAnimation(this.game.mainloop),this.punchUp=r.HERO_PUNCH_UP.getAnimation(this.game.mainloop),this.punchDown=r.HERO_PUNCH_DOWN.getAnimation(this.game.mainloop),this.punchLeft=r.HERO_PUNCH_LEFT.getAnimation(this.game.mainloop),this.punchRight=r.HERO_PUNCH_RIGHT.getAnimation(this.game.mainloop),this.currentAnimation=this.walkUp,t.prototype.init.call(this,this.game.physicsEngine.world),this.createCircleBody(this.bodyRadius)},e.prototype.move=function(t){if(!this.isPunch){var e=a.directionVectorToDirection(t);switch(this.isAnimation=!0,e){case l.default.LEFT:this.currentAnimation=this.walkLeft;break;case l.default.RIGHT:this.currentAnimation=this.walkRight;break;case l.default.UP:this.currentAnimation=this.walkUp;break;case l.default.DOWN:this.currentAnimation=this.walkDown;break;case l.default.NONE:return void(this.isAnimation=!1)}}},e.prototype.punch=function(t){var e=this;switch(a.directionVectorToDirection(t)){case l.default.LEFT:this.currentAnimation=this.walkLeft;break;case l.default.RIGHT:this.currentAnimation=this.walkRight;break;case l.default.UP:this.currentAnimation=this.walkUp;break;case l.default.DOWN:this.currentAnimation=this.walkDown;break;case l.default.NONE:return this.isAnimation=!1,void(this.isPunch=!1)}this.isAnimation=!0,this.isPunch=!0,this.currentAnimation.playFromBeginning().loop(!1).once("done",function(){e.isPunch=!1,e.isAnimation=!1})},e.prototype.update=function(){t.prototype.update.call(this);var e=new s.Victor(0,0);if(this.dirMovement.isMoving())e=this.dirMovement.getNormDirectionVector();else if(this.targetMovement.isMoving()){if(this.targetMovement.getDistanceToTarget()<3)return void this.game.player.entity.targetMovement.stopMoving();e=this.targetMovement.getNormDirectionVector()}this.bodyVelocity.x=e.x*this.speed,this.bodyVelocity.y=e.y*this.speed,s.Matter.Body.setVelocity(this.body,this.bodyVelocity),this.move(e),this.isAnimation&&(this.currentAnimation.update(),this.sprite.setTile(this.currentAnimation.getCurrentTile()))},e.prototype.draw=function(){this.sprite.positioner.bottom(this.positionOfCenterInWorld.y+this.bodyRadius).centerX(this.positionOfCenterInWorld.x).setLeftTopPosition(),this.sprite.draw()},e}(p.default);e.default=h},function(t,e,n){"use strict";e.__esModule=!0;var i=n(1),o=n(0),r=function(){function t(){this.moveLeft=!1,this.moveRight=!1,this.moveUp=!1,this.moveDown=!1,this.dir=new o.Victor(0,0)}return t.prototype.isMoving=function(){return this.moveLeft||this.moveRight||this.moveDown||this.moveUp},t.prototype.isMovingLeft=function(){return this.moveLeft},t.prototype.isMovingRight=function(){return this.moveRight},t.prototype.isMovingDown=function(){return this.moveDown},t.prototype.isMovingUp=function(){return this.moveUp},t.prototype.goLeft=function(){this.moveLeft=!0},t.prototype.goRight=function(){this.moveRight=!0},t.prototype.goUp=function(){this.moveUp=!0},t.prototype.goDown=function(){this.moveDown=!0},t.prototype.goDirection=function(t){t===i.default.LEFT&&this.goLeft(),t===i.default.RIGHT&&this.goRight(),t===i.default.DOWN&&this.goDown(),t===i.default.UP&&this.goUp()},t.prototype.stopGoLeft=function(){this.moveLeft=!1},t.prototype.stopGoRight=function(){this.moveRight=!1},t.prototype.stopGoUp=function(){this.moveUp=!1},t.prototype.stopGoDown=function(){this.moveDown=!1},t.prototype.stopGoDirection=function(t){t===i.default.LEFT&&this.stopGoLeft(),t===i.default.RIGHT&&this.stopGoRight(),t===i.default.DOWN&&this.stopGoDown(),t===i.default.UP&&this.stopGoUp()},t.prototype.stopMoving=function(){this.moveLeft=!1,this.moveRight=!1,this.moveUp=!1,this.moveDown=!1},t.prototype.getNormDirectionVector=function(){return this.dir.x=this.dir.y=0,this.moveLeft&&(this.dir.x-=1),this.moveRight&&(this.dir.x+=1),this.moveUp&&(this.dir.y-=1),this.moveDown&&(this.dir.y+=1),this.dir},t}();e.default=r},function(t,e,n){"use strict";e.__esModule=!0;var i=n(0),o=function(){function t(t){this.objToMove=t}return t.prototype.isMoving=function(){return null!=this.target},t.prototype.stopMoving=function(){this.target=null},t.prototype.goTarget=function(t){this.target=t},t.prototype.getDistanceToTarget=function(){var t=this.target.clone(),e=this.objToMove.getPosition();return t.subtract(e).length()},t.prototype.getNormDirectionVector=function(){return this.isMoving()?this.target.clone().subtract(this.objToMove.getPosition()).norm():new i.Victor(0,0)},t}();e.default=o},function(t,e,n){"use strict";e.__esModule=!0;var i=function(){function t(){this.onKeyDownActions={},this.onScrollUpActions=[],this.onScrollDownActions=[],this.onMouseDownActions=[],this.onRightClickActions=[],this.onLeftClickActions=[],this.onOnlyKeyDownActions={},this._noContextMenu=!1}return t.prototype.init=function(){var t=this;return window.addEventListener("keydown",function(e){var n=t.onOnlyKeyDownActions[e.key];null==n||n.isExecuted()||n.execute()}),window.addEventListener("keyup",function(e){var n=t.onOnlyKeyDownActions[e.key];null!=n&&n.finish()}),window.addEventListener("mousedown",function(e){e.preventDefault();for(var n=0,i=t.onMouseDownActions;n<i.length;n++){i[n].execute(e)}}),window.addEventListener("click",function(e){if(e.preventDefault(),0===e.button)for(var n=0,i=t.onLeftClickActions;n<i.length;n++){i[n].execute(e)}}),window.addEventListener("contextmenu",function(e){t._noContextMenu&&e.preventDefault();for(var n=0,i=t.onRightClickActions;n<i.length;n++){i[n].execute(e)}}),window.addEventListener("wheel",function(e){var n=e.deltaY||e.detail||e.wheelDelta;if(n<0)for(var i=0,o=t.onScrollUpActions;i<o.length;i++){o[i].execute()}if(n>0)for(var r=0,s=t.onScrollDownActions;r<s.length;r++){s[r].execute()}}),this},t.prototype.noContextMenu=function(){return this._noContextMenu=!0,this},t.prototype.onKeyDwon=function(t,e){this.onKeyDownActions[t]=e},t.prototype.onOnlyKeyDwon=function(t,e){this.onOnlyKeyDownActions[t]=e},t.prototype.onMouseDown=function(t){this.onMouseDownActions.push(t)},t.prototype.onRightClick=function(t){this.onRightClickActions.push(t)},t.prototype.onLeftClick=function(t){this.onLeftClickActions.push(t)},t.prototype.onScrollUp=function(t){this.onScrollUpActions.push(t)},t.prototype.onScrollDown=function(t){this.onScrollDownActions.push(t)},t}();e.default=i},function(t,e,n){"use strict";var i,o=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),r=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(o,r){function s(t){try{l(i.next(t))}catch(t){r(t)}}function a(t){try{l(i.throw(t))}catch(t){r(t)}}function l(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(s,a)}l((i=i.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){var n,i,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}};e.__esModule=!0;var a=n(38),l=n(12),c=n(0),u=n(5),p=function(t){function e(e,n){var i=t.call(this,e)||this;return i.canvas=n,i.ctx=i.canvas.context,i}return o(e,t),e.prototype.load=function(){return r(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return[4,this.loadAndParse()];case 1:return t.sent(),[2]}})})},e.prototype.setBodiesContainer=function(t){return this.bodiesContainer=t,this},e.prototype.setGameCamera=function(t){return this.gameCamera=t,this},e.prototype.addStaticObjectsFromObjectLayer=function(t){for(var e=0,n=this.getObjectLayer(t).objects;e<n.length;e++){var i=n[e],o=i.x+i.width/2,r=i.y+i.height/2,s=u.default.getArcadeBodySettings();s.isStatic=!0,c.Matter.Composite.add(this.bodiesContainer,c.Matter.Bodies.rectangle(o,r,i.width,i.height,s))}},e.prototype.drawTilelayer=function(t){for(var e=new c.Victor(0,0),n=0;n<t.data.length;n++){var i=t.data[n];if(i>0){var o=this.getTileById(i);e.x=t.x+n%t.width,e.y=t.y+Math.floor(n/t.width),e.x*=o.size.x,e.y*=o.size.y,this.canvas.drawTile(o,e)}}},e.prototype.draw=function(){for(var t=0,e=this.map.layers;t<e.length;t++){var n=e[t];this.isTilelayer(n)&&this.drawTilelayer(n)}},e.prototype.makeCacheFromAllLayers=function(){var t=this.canvas;this.cachedCanvas=(new l.default).create(this.size),this.canvas=this.cachedCanvas,this.draw(),this.canvas=t},e.prototype.makeCacheFromVisibleLayers=function(){var t=this.canvas;this.cachedCanvas=(new l.default).create(this.size),this.canvas=this.cachedCanvas;for(var e=0,n=this.map.layers;e<n.length;e++){var i=n[e];this.isTilelayer(i)&&i.visible&&this.drawTilelayer(i)}this.canvas=t},e.prototype.drawFromCache=function(){if(null!=this.gameCamera){var t=this.gameCamera.positionInWorld,e=this.gameCamera.size;this.canvas.context.drawImage(this.cachedCanvas.canvasEl,t.x,t.y,e.x,e.y,t.x,t.y,e.x,e.y)}else this.canvas.context.drawImage(this.cachedCanvas.canvasEl,0,0)},e}(a.default);e.default=p},function(t,e,n){"use strict";var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(o,r){function s(t){try{l(i.next(t))}catch(t){r(t)}}function a(t){try{l(i.throw(t))}catch(t){r(t)}}function l(t){t.done?o(t.value):new n(function(e){e(t.value)}).then(s,a)}l((i=i.apply(t,e||[])).next())})},o=this&&this.__generator||function(t,e){var n,i,o,r,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){s.label=r[1];break}if(6===r[0]&&s.label<o[1]){s.label=o[1],o=r;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(r);break}o[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}};e.__esModule=!0;var r=n(4),s=n(0),a=n(2),l=function(){function t(t){this.size=new s.Victor(0,0),this.tilesets=[],this.tiles=[],this.filename=t,this.dirname=s.path.dirname(this.filename)}return t.prototype.isTileset=function(t){return null==t.source},t.prototype.isTilelayer=function(t){return"tilelayer"==t.type},t.prototype.isObjectlayer=function(t){return"objectgroup"==t.type},t.prototype.getObjectLayer=function(t){for(var e=0,n=this.map.layers;e<n.length;e++){var i=n[e];if(this.isObjectlayer(i)&&i.name===t)return i}},t.prototype.loadAndParseTileset=function(t){return i(this,void 0,void 0,function(){var e;return o(this,function(n){switch(n.label){case 0:return t.image=s.path.join(this.dirname,t.image),e=t,[4,r.loadImage(t.image)];case 1:return e.img=n.sent(),[2,t]}})})},t.prototype.loadAndParse=function(){return i(this,void 0,void 0,function(){var t,e,n,i,a,l=this;return o(this,function(o){switch(o.label){case 0:return t=this,[4,r.loadJsonFile(this.filename)];case 1:for(t.map=o.sent(),this.size.x=this.map.width*this.map.tilewidth,this.size.y=this.map.height*this.map.tileheight,e=[],n=0;n<this.map.tilesets.length;n++)i=this.map.tilesets[n],this.isTileset(i)?e.push(this.loadAndParseTileset(i)):(i.source=s.path.join(this.dirname,i.source),e.push(r.loadJsonFile(i.source).then(function(t){return l.loadAndParseTileset(t)})));return a=this,[4,Promise.all(e)];case 2:return a.tilesets=o.sent(),[2]}})})},t.prototype.getTileById=function(t){if(null!=this.tiles[t])return this.tiles[t];for(var e=this.tilesets.length-1;e>=0;e--){var n=this.tilesets[e];if(t>=n.firstgid){var i=t-n.firstgid,o=Math.floor(i/n.columns),r=i%n.columns,s=a.default.fromImageAndArray(n.img,[n.tilewidth,n.tileheight,r,o]);return this.tiles[t]=s,s}}},t}();e.default=l},function(t,e,n){"use strict";e.__esModule=!0;var i=function(){function t(t){this.entities=[],this.gameCamera=t}return t.prototype.addEntity=function(t){return this.entities.push(t),this},t.prototype.findAll=function(t){for(var e=[],n=0,i=this.entities;n<i.length;n++){var o=i[n],r=o.getLeftTopPosition();r.x<t.x&&t.x<=r.x+o.size.x&&r.y<t.y&&t.y<=r.y+o.size.y&&e.push(o)}return e},t.prototype.update=function(){for(var t=[],e=0,n=this.entities;e<n.length;e++){var i=n[e];i.killed?t.push(i):i.update()}t.length>0&&(this.entities=this.entities.filter(function(e){return!(t.indexOf(e)>=0)}))},t.prototype.sortEntities=function(t){t.sort(function(t,e){var n=t.getPosition(),i=e.getPosition();return t.zindex<e.zindex?-1:t.zindex>e.zindex?1:n.y<i.y?-1:n.y>i.y?1:n.x<i.x?-1:n.x>i.x?1:0})},t.prototype.draw=function(){for(var t=[],e=this.gameCamera.positionInWorld.x,n=this.gameCamera.positionInWorld.y,i=this.gameCamera.size.x,o=this.gameCamera.size.y,r=0,s=this.entities;r<s.length;r++){var a=(d=s[r]).getPosition(),l=d.size.x/2,c=d.size.y/2;a.x<e-l||a.x>e+i+l||a.y<n-c||a.y>n+o+c||t.push(d)}this.sortEntities(t);for(var u=0,p=t;u<p.length;u++){var d;(d=p[u]).draw()}},t}();e.default=i},function(t,e,n){"use strict";e.__esModule=!0,e.init=function(t){console.log("Debug mode inited"),t}},function(t,e,n){"use strict";e.__esModule=!0,e.default=!1}]);